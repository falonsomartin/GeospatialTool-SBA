(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{165:function(e,t){},244:function(e,t,a){e.exports=a(371)},262:function(e,t,a){},263:function(e,t,a){},270:function(e,t,a){},350:function(e,t,a){},351:function(e,t,a){},367:function(e,t){},371:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(21),r=a.n(i),l=a(218),s=a(81),c=a(14),d=a(13),u=a(18),m=a(17),p=a(19),h=a(121),g=a(428),f=new(a(164).EventEmitter),v=(a(262),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={key:null},a.handleCloseClick=function(e){a.props.closeSnackbar(e)},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=function(t){return o.a.createElement(o.a.Fragment,null,o.a.createElement(g.a,{className:"snackbar-btn white-text",onClick:e.handleCloseClick.bind(e,t)},"DISMISS"))};this.showSnackbarListener=f.addListener("showSnackbar",function(a,n){console.log(n),e.props.enqueueSnackbar(n,{variant:a,autoHideDuration:3e3,action:t})}),this.showloggingSnackbarListener=f.addListener("showloggingSnackbar",function(t){var a="Logging to ".concat(t,"..."),n=e.props.enqueueSnackbar(a,{variant:"info",persist:!0});e.setState({key:n})}),this.hideloggingSnackbarListener=f.addListener("hideloggingSnackbar",function(){e.props.closeSnackbar(e.state.key)})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.showSnackbarListener),f.removeListener(this.showloggingSnackbarListener),f.removeListener(this.hideloggingSnackbarListener)}},{key:"render",value:function(){return o.a.createElement("div",null)}}]),t}(o.a.Component)),y=Object(h.withSnackbar)(v),b=a(43),x=a.n(b),C={root:{position:"fixed",top:0,zIndex:900},logoContainer:{height:"60px",padding:"2px 10px 1px 0px;"},logo:{height:"55px"},flexContainer:{position:"absolute",right:12,display:"flex",flexDirection:"row-reverse",justifyContent:"flex-start"},svgIcon:{width:24,height:24},fontIcon:{fontSize:29},toolbar:{background:"#89ca92"}},E=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={modal:null},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("about"),a=x.a.Modal.init(t);e.setState({modal:a})})}},{key:"componentWillUnmount",value:function(){this.state.modal.destory()}},{key:"render",value:function(){return o.a.createElement("div",{id:"about",className:"modal"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("h4",null,"About"),o.a.createElement("p",null,"Designed & Written by\xa0",o.a.createElement("a",{href:"https://evenor-tech.com/"},"Evenor-Tech"),"."),o.a.createElement("p",null,o.a.createElement("a",{style:C.logoContainer,href:"https://www.steambioafrica.com/"},o.a.createElement("img",{style:C.logo,src:"./static/assets/eu.png",alt:""})))),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{className:"modal-close waves-effect waves-light btn-flat"},"OK")))}}]),t}(o.a.Component),w=a(429),k=a(430),S=a(375),I=a(224),L=a(431),O=a(87),D=a(427),j=a(199),P=a.n(j),T=Object(O.b)({palette:{primary:{main:P.a[900]}}}),B={root:{position:"fixed",top:0,zIndex:900},logoContainer:{height:"60px",padding:"2px 10px 1px 0px;"},logo:{height:"55px"},flexContainer:{position:"absolute",right:12,display:"flex",flexDirection:"row-reverse",justifyContent:"flex-start"},svgIcon:{width:24,height:24},fontIcon:{fontSize:29},toolbar:{background:"#89ca92"}},A=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={loggedin:!1,token:null},a.handleLoginClick=function(){f.emit("login")},a.handleLogoutClick=function(){f.emit("removeAllLayer"),f.emit("removeDataset"),f.emit("removeAllDataset"),f.emit("handleDatasetRemove"),localStorage.removeItem("token"),localStorage.removeItem("jwt"),document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}),f.emit("showSnackbar","success","Logout successfully."),a.setState({token:null,loggedin:!1})},a.handleToken=function(e){console.log("Received token:",e),a.setState({token:e})},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setLoginStateListener=f.addListener("setLoginState",function(t){e.setState({loggedin:t})}),f.on("handleToken",this.handleToken)}},{key:"componentWillUnmount",value:function(){f.removeListener(this.setLoginStateListener)}},{key:"render",value:function(){return o.a.createElement(D.a,{theme:T},o.a.createElement(w.a,{style:B.root,position:"static"},o.a.createElement(k.a,{style:B.toolbar},o.a.createElement("a",{style:B.logoContainer,href:"https://evenor-tech.com/"},o.a.createElement("img",{style:B.logo,src:"./static/assets/logo.png",alt:""})),"\xa0 \xa0 \xa0 \xa0",o.a.createElement("a",{style:B.logoContainer,href:"https://www.steambioafrica.com/"},o.a.createElement("img",{style:B.logo,src:"./static/assets/bioafrica.png",alt:""})),o.a.createElement("div",{style:B.flexContainer},o.a.createElement(S.a,{title:"About","aria-label":"About",enterDelay:200},o.a.createElement(I.a,{className:"icon-container modal-trigger","aria-label":"About",color:"inherit","data-target":"about"},o.a.createElement(L.a,{style:B.fontIcon},"info_outline"))),null!=this.state.token?o.a.createElement(S.a,{title:"Logout","aria-label":"Logout",enterDelay:200},o.a.createElement(I.a,{className:"icon-container","aria-label":"Logout",color:"inherit",onClick:this.handleLogoutClick},o.a.createElement(L.a,{style:B.fontIcon},"exit_to_app"))):o.a.createElement(S.a,{title:"Login","aria-label":"Login",enterDelay:200},o.a.createElement(I.a,{className:"icon-container","aria-label":"Login",color:"inherit",onClick:this.handleLoginClick},o.a.createElement(L.a,{style:B.fontIcon},"account_circle")))))))}}]),t}(o.a.Component),R=a(464),M=a(465),_=a(432),F=(a(263),{root:{position:"fixed",right:24,bottom:24,zIndex:1e3}}),U=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={open:!1,actions:[{name:"Switch style",icon:o.a.createElement(L.a,null,"brush"),color:"red accent-2",callback:function(){f.emit("closeAllController"),f.emit("openStyleController"),a.handleClose()}},{name:"Spatiotemporal Analysis",icon:o.a.createElement(L.a,null,"satellite_alt"),color:"orange",callback:function(){f.emit("closeAllController"),f.emit("openSpatioTemporalAnalysisController"),a.handleClose()}},{name:"Vegetation Index Change Inspector",icon:o.a.createElement(L.a,null,"image_search"),color:"blue",callback:function(){f.emit("closeAllController"),f.emit("openVegInspectorController"),a.handleClose()}},{name:"Rusle Modelling",icon:o.a.createElement(L.a,null,"grass"),color:"green",callback:function(){f.emit("closeAllController"),f.emit("openRusleController"),a.handleClose()}},{name:"SOC Prediction",icon:o.a.createElement(L.a,null,"psychology"),color:"purple darken-1",callback:function(){f.emit("closeAllController"),f.emit("openSocController"),a.handleClose()}},{name:"Configure layers",icon:o.a.createElement(L.a,null,"layers"),color:"yellow darken-1",callback:function(){f.emit("closeAllController"),f.emit("openLayerController"),a.handleClose()}}]},a.handleClick=function(){a.setState(function(e){return{open:!e.open}})},a.handleOpen=function(){a.setState({open:!0})},a.handleClose=function(){a.setState({open:!1})},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.openMenuListener=f.addListener("openMenu",function(){e.setState({open:!0})})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openMenuListener)}},{key:"render",value:function(){return o.a.createElement(R.a,{style:F.root,open:this.state.open,ariaLabel:"Menu",icon:o.a.createElement(M.a,{icon:o.a.createElement(L.a,null,"menu"),openIcon:o.a.createElement(L.a,null,"clear")}),onMouseEnter:this.handleOpen,onMouseLeave:this.handleClose,onClick:this.handleClick},this.state.actions.map(function(e){return o.a.createElement(_.a,{key:e.name,className:e.color,icon:e.icon,tooltipTitle:e.name,onClick:e.callback})}))}}]),t}(o.a.Component),N=a(12),W=a.n(N),z=a(22),H=a(201),V=a.n(H),G=a(461),q=a(438),J=a(433),Z=a(181),K=a(466),$=a(111),Q=a(45),Y=a.n(Q),X=a(457),ee=a(165),te=a.n(ee),ae=a(456);ae.a.defaults.baseURL="http://localhost:5000",ae.a.defaults.withCredentials=!0;var ne=Object(O.b)({palette:{primary:{main:Y.a.A200}}}),oe=["41046A010000100000DU","41041A014001860000HF","41041A014001790000HQ","41041A015002920000HF","41041A015002760000HH","41041A015002730000HS","41041A014000920000HF","41041A007003790000HK","41041A005000430000HO"];ae.a.interceptors.request.use(function(e){var t=new URL(e.url).origin,a=["http://localhost:5000"],n=localStorage.getItem("token");return a.includes(t)&&(e.headers.authorization="Bearer ".concat(n)),e},function(e){return Promise.reject(e)});var ie={loginContainer:{width:300,height:350,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},title:{marginBottom:20},inputBox:{width:240,marginTop:15},autocomplete:{width:240,display:"flex",flexWrap:"wrap",overflow:"auto"},checkBox:{width:140},loginBtnContainer:{display:"inline-block",position:"relative"},loginBtn:{width:120,marginTop:20},loginBtnProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-3,marginLeft:-12}},re=o.a.forwardRef(function(e,t){return o.a.createElement(Z.a,Object.assign({direction:"down",ref:t},e))}),le=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1,remember:!1,logining:!1,mode:"login",selectedOptions:[],datasets:{}},a.handleLoginClose=function(){a.setState({open:!1})},a.handleRememberChange=function(e){a.setState({remember:e.target.checked})},a.handleChangeForm=function(e){a.setState({mode:"login"===a.state.mode?"Login":"Register"}),console.log(a.state.mode)},a.handleChangeAutoComplete=function(e,t){var n=t.map(function(e){return e.reference});a.setState({selectedOptions:n},function(){console.log(a.state.selectedOptions)})},a.getUserParcels=function(){var e=Object(z.a)(W.a.mark(function e(t){var n;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.a.get("http://localhost:5000/users/".concat(t,"/parcels"));case 3:200===(n=e.sent).status?(a.updateDatasetUtilsFile(n.data),console.log("Parcelas recibidas:",n.data)):console.error("No se pudieron obtener las parcelas:",n.statusText),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error al obtener las parcelas:",e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),a.handleLoginClick=Object(z.a)(W.a.mark(function e(){var t,n,o,i;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({logining:!0}),t={username:document.getElementById("username").value,password:V()(document.getElementById("password").value)},e.next=4,ae.a.post("http://localhost:5000/login",t);case 4:200===(n=e.sent).status&&(o=n.data.message[0],i=n.data.message[1],f.emit("handleToken",i),localStorage.removeItem("token"),localStorage.removeItem("jwt"),localStorage.setItem("token",i),f.emit("showSnackbar","success","User login successfully."),f.emit("setLoginState",!0),a.getUserParcels(o),a.setState({open:!1,logining:!1,idUser:o}),console.log(localStorage.getItem("token")));case 6:case"end":return e.stop()}},e)})),a.moveDataset=function(){var e=a.state.datasets;a.setState({movedData:e}),console.log(a.state.movedData)},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"updateDatasetUtilsFile",value:function(e){e.forEach(function(e){te.a[e.catastral_ref]={data:e.geojson_data}}),this.setState({datasets:te.a}),console.log("Updated datasets:",this.state.datasets),f.emit("moveDataset",this.state.datasets)}},{key:"componentDidMount",value:function(){var e=this;this.loginListener=f.addListener("login",function(){e.setState({open:!0})}),this.moveDatasetListener=f.addListener("moveDataset",function(){e.moveDataset()})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.loginListener),f.removeListener(this.moveDatasetListener)}},{key:"render",value:function(){return o.a.createElement(D.a,{theme:ne},o.a.createElement(J.a,{open:this.state.open,TransitionComponent:re,onClose:this.handleLoginClose},o.a.createElement("div",{style:ie.loginContainer},"login"===this.state.mode?o.a.createElement(o.a.Fragment,null,o.a.createElement($.a,{style:ie.title,variant:"h5",gutterBottom:!0},"Inicio de Sesi\xf3n"),o.a.createElement(K.a,{style:ie.inputBox,variant:"outlined",margin:"dense",id:"username",label:"Usuario"}),o.a.createElement(K.a,{style:ie.inputBox,variant:"outlined",margin:"dense",id:"password",type:"password",label:"Contrase\xf1a"})):o.a.createElement(o.a.Fragment,null,o.a.createElement($.a,{style:ie.title,variant:"h5",gutterBottom:!0},"Registro"),o.a.createElement(K.a,{style:ie.inputBox,variant:"outlined",margin:"dense",id:"username",label:"Usuario"}),o.a.createElement(K.a,{style:ie.inputBox,variant:"outlined",margin:"dense",id:"password",type:"password",label:"Contrase\xf1a"}),o.a.createElement(X.a,{style:ie.inputBox,multiple:!0,onChange:this.handleChangeAutoComplete,limitTags:1,id:"checkboxes-tags-demo",options:oe,getOptionLabel:function(e){return e},renderOption:function(e,t){var a=t.selected;return o.a.createElement(o.a.Fragment,null,o.a.createElement(G.a,{style:{marginRight:1,marginLeft:1},checked:a}),e)},renderInput:function(e){return o.a.createElement(K.a,Object.assign({id:"lista"},e,{variant:"outlined",label:"Checkboxes",placeholder:"Favorites"}))},renderTags:function(){return null}})),o.a.createElement("div",{style:ie.loginBtnContainer},o.a.createElement(g.a,{style:ie.loginBtn,variant:"contained",color:"primary",disabled:this.state.logining,onClick:this.handleLoginClick},"INICIAR SESI\xd3N"),this.state.logining&&o.a.createElement(q.a,{style:ie.loginBtnProgress,size:24}),o.a.createElement(g.a,{style:ie.loginBtn,onClick:this.handleChangeForm,color:"primary"},"login"===this.state.mode?"Register":"Login")))))}}]),t}(o.a.Component),se=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={tapTarget:null},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("DOMContentLoaded",function(){document.getElementsByClassName("MuiSpeedDial-fab")[0].setAttribute("id","menu");var t=document.querySelectorAll(".tap-target"),a=x.a.TapTarget.init(t)[0];a.open(),e.setState({tapTarget:a})})}},{key:"componentWillUnmount",value:function(){this.state.tapTarget.destory()}},{key:"render",value:function(){return o.a.createElement("div",{className:"tap-target indigo accent-2","data-target":"menu"},o.a.createElement("div",{className:"tap-target-content white-text"},o.a.createElement("h5",null,"Welcome to GeoViewer!"),o.a.createElement("p",null,"This is an online, light-weight and user-friendly geographical information visualizer, made with ReactJS + Material-UI + Mapbox-GL.")))}}]),t}(o.a.Component),ce=a(439),de=a(440),ue=a(441),me={Satellite:"mapbox://styles/mapbox/satellite-v9",Custom:"mapbox://styles/almafe2510/clw7qv6il02ok01qr9w4wdbv0",Standard:""},pe=(a(270),{root:{position:"fixed",top:74,right:10,borderRadius:4,width:320,margin:0,zIndex:900},header:{backgroundColor:"#f1f1f1"},closeBtn:{position:"absolute",top:6,right:8,fontSize:22},stylePreview:{width:60,height:60,borderRadius:2,cursor:"pointer"}}),he=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1},a.handleCloseClick=function(){a.setState({open:!1})},a.handleStyleClick=function(e){f.emit("setMapStyle",e),a.handleCloseClick()},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.openStyleControllerListener=f.addListener("openStyleController",function(){e.setState({open:!0})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openStyleControllerListener),f.removeListener(this.closeAllControllerListener)}},{key:"render",value:function(){var e=this;return o.a.createElement(Z.a,{direction:"left",in:this.state.open},o.a.createElement(ce.a,{style:pe.root},o.a.createElement(de.a,{style:pe.header},o.a.createElement($.a,{gutterBottom:!0,variant:"h5",component:"h2"},"Map Styles"),o.a.createElement($.a,{variant:"body2",color:"textSecondary"},"Click to choose a map style"),o.a.createElement(I.a,{style:pe.closeBtn,"aria-label":"Close",onClick:this.handleCloseClick},o.a.createElement(L.a,{fontSize:"inherit"},"chevron_right"))),o.a.createElement(de.a,null,o.a.createElement(ue.a,{container:!0,spacing:2},Object.keys(me).map(function(t,a){return o.a.createElement(ue.a,{item:!0,style:pe.styleCard,key:a,xs:3},o.a.createElement("img",{src:"./static/assets/".concat(t,".png"),alt:"",className:"hoverable",style:pe.stylePreview,onClick:e.handleStyleClick.bind(e,t)}))})))))}}]),t}(o.a.Component),ge=a(27),fe=a(23),ve=a(467),ye=a(436),be=a(469),xe=a(459),Ce=a(434),Ee=a(470),we=a(442),ke=a(443),Se=a(437),Ie=a(380),Le=a(444),Oe=a(471),De=a(445),je=a(144),Pe=Object(O.b)({palette:{primary:{main:je.a.A200}}}),Te={root:{position:"fixed",top:74,right:10,width:300,borderRadius:4,margin:0,zIndex:900},header:{backgroundColor:"#f1f1f1"},closeBtn:{position:"absolute",top:6,right:8,fontSize:22},content:{paddingBottom:16},select:{width:"100%"},placeholder:{height:28,lineHeight:"28px",cursor:"pointer"},chipContainer:{display:"flex",overflow:"hidden"},chip:{height:28,lineHeight:"28px",marginRight:5},layerList:{marginTop:6,paddingBottom:0},layerItem:{paddingLeft:2},sortAction:{right:12}},Be=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1,mapp:null,selected:{},resolution:7,zoom:0,layerForm:"Border",datasetss:{}},a.handleCloseClick=function(){a.setState({open:!1})},a.handleDatasetChange=function(){var e=Object(z.a)(W.a.mark(function e(t){var n,o;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,Object.keys(a.state.selected).map(function(e){return n=!0,a.setState({selected:{}}),!0}),!n&&t.target.value.length&&(o=t.target.value[t.target.value.length-1],f.emit("showSnackbar","default","Downloading dataset '".concat(o,"'.")),f.emit("displayDataset",o,a.state.datasetss[o].data,"#f08"),f.emit("showSnackbar","success","Dataset '".concat(o,"' downloaded successfully.")));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleDrop=function(e){e.preventDefault();var t=e.dataTransfer.files;if(t.length>0){var n=t[0],o=new FileReader;o.onload=function(e){var t=JSON.parse(e.target.result);a.setState({datasets:Object(fe.a)({},a.state.datasets,Object(ge.a)({},n.name,{data:t}))}),f.emit("displayDataset",n.name,t),f.emit("showSnackbar","success","Dataset '".concat(n.name,"' downloaded successfully."))},o.readAsText(n)}},a.updateDatasets=function(){var e=a.state.mapp,t={};console.log(e),e.forEach(function(e){console.log(e),"predictedSOC"===e.id&&(console.log(e),t[e.id]={})}),console.log(t),console.log(Object.keys(t)),console.log(Object.values(t)),a.setState({selected:t}),a.setState({datasetss:t})},a.handleMAPMoved=function(e){console.log("ASASJ"),console.log(e);var t=e.getStyle().layers;console.log(t),a.setState({mapp:t}),a.updateDatasets()},a.handleDataMoved=function(e){a.setState({datasets:e})},a.handleLayerFormBor=function(){a.setState({layerForm:"Border"})},a.handleLayerFormHex=function(){a.setState({layerForm:"Hexagonal"})},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log("ASA"),this.openLayerControllerListener=f.addListener("openLayerController",function(){e.setState({open:!0})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})}),this.setMapZoomListener=f.addListener("setMapZoom",function(t){e.setState({zoom:t})}),this.handleDatasetRemoveListener=f.addListener("handleDatasetRemove",function(){e.handleDatasetRemove()}),f.on("moveDataset",this.handleDataMoved),f.on("moveMAP",this.handleMAPMoved),window.addEventListener("dragover",this.handleDragOver),window.addEventListener("drop",this.handleDrop)}},{key:"componentDidUpdate",value:function(e){this.props.map!==e.map&&this.updateDatasets()}},{key:"handleDatasetRemove",value:function(){this.setState({datasets:{},selected:{}})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openLayerControllerListener),f.removeListener(this.closeAllControllerListener),f.removeListener(this.setMapZoomListener),f.removeListener(this.handleDatasetRemoveListener),window.removeEventListener("dragover",this.handleDragOver),window.removeEventListener("drop",this.handleDrop)}},{key:"render",value:function(){var e=this;return console.log(this.state.selected),o.a.createElement(D.a,{theme:Pe},o.a.createElement(Z.a,{direction:"left",in:this.state.open},o.a.createElement(ce.a,{style:Te.root},o.a.createElement(de.a,{style:Te.header},o.a.createElement($.a,{gutterBottom:!0,variant:"h5",component:"h2"},"Layers"),o.a.createElement($.a,{variant:"body2",color:"textSecondary"},"Download and display layers"),o.a.createElement(S.a,{title:"Hexagons","aria-label":"Hexagons",enterDelay:200},o.a.createElement(I.a,{"aria-label":"Hexagons",onClick:this.handleLayerFormHex},o.a.createElement(L.a,{fontSize:"inherit"},"crop"))),o.a.createElement(S.a,{title:"Border","aria-label":"Border",enterDelay:200,onClick:this.handleLayerFormBor},o.a.createElement(I.a,{"aria-label":"Border"},o.a.createElement(L.a,{fontSize:"inherit"},"border_style"))),o.a.createElement(I.a,{style:Te.closeBtn,"aria-label":"Close",onClick:this.handleCloseClick},o.a.createElement(L.a,{fontSize:"inherit"},"chevron_right"))),"Hexagonal"===this.state.layerForm?o.a.createElement(de.a,{style:this.state.selected.length?Te.content:null},o.a.createElement(ye.a,{style:Te.select},o.a.createElement(be.a,{shrink:!0,htmlFor:"resolution-label"},"Resolution"),"\xa0\xa0\xa0",o.a.createElement(ve.a,{value:this.state.resolution,min:1,max:15,step:1,onChange:this.handleResolutionChange}),o.a.createElement(xe.a,{displayEmpty:!0,value:this.state.selected,onChange:this.handleDatasetChange,input:o.a.createElement(Ce.a,{id:"dataset-label"}),renderValue:function(t){return t.length?o.a.createElement("div",{style:Te.chipContainer},Object.keys(e.state.selected).map(function(e){return o.a.createElement(Ee.a,{key:e,style:Te.chip,label:e})})):o.a.createElement(be.a,{style:Te.placeholder},"Choose layers")}},Object.keys(this.state.datasetss).map(function(t){return o.a.createElement(we.a,{key:t,value:t},o.a.createElement(G.a,{checked:Object.keys(e.state.selected).indexOf(t)>-1,color:"primary",onChange:e.handleDatasetChange,value:t}),o.a.createElement(ke.a,{primary:t}))}))),o.a.createElement(Se.a,{id:"layers",style:Te.layerList},Object.keys(this.state.selected).map(function(e){return o.a.createElement(Ie.a,{style:Te.layerItem,key:e},o.a.createElement(Le.a,null,o.a.createElement(Oe.a,null,o.a.createElement(L.a,{color:"action"},"layers"))),o.a.createElement(ke.a,{primary:e}),o.a.createElement(De.a,{style:Te.sortAction},o.a.createElement(I.a,{className:"handle",edge:"end","aria-label":"Sort",disableRipple:!0,disableFocusRipple:!0},o.a.createElement(L.a,null,"menu"))))}))):o.a.createElement(de.a,{style:Object.keys(this.state.selected).length?Te.content:null},o.a.createElement(ye.a,{style:Te.select},o.a.createElement(xe.a,{displayEmpty:!0,value:this.state.selected,onChange:this.handleDatasetChange,input:o.a.createElement(Ce.a,{id:"dataset-label"}),renderValue:function(t){return t.length?o.a.createElement("div",{style:Te.chipContainer},Object.keys(e.state.selected).map(function(e){return o.a.createElement(Ee.a,{key:e,style:Te.chip,label:e})})):o.a.createElement(be.a,{style:Te.placeholder},"Choose layers")}},Object.keys(this.state.datasetss).map(function(t){return o.a.createElement(we.a,{key:t,value:t},o.a.createElement(G.a,{checked:Object.keys(e.state.selected).indexOf(t)>-1,color:"primary",onChange:e.handleDatasetChange,value:t}),o.a.createElement(ke.a,{primary:t}))}))),o.a.createElement(Se.a,{id:"layers",style:Te.layerList},Object.keys(this.state.selected).map(function(e){return o.a.createElement(Ie.a,{style:Te.layerItem,key:e},o.a.createElement(Le.a,null,o.a.createElement(Oe.a,null,o.a.createElement(L.a,{color:"action"},"layers"))),o.a.createElement(ke.a,{primary:e}),o.a.createElement(De.a,{style:Te.sortAction},o.a.createElement(I.a,{className:"handle",edge:"end","aria-label":"Sort",disableRipple:!0,disableFocusRipple:!0},o.a.createElement(L.a,null,"menu"))))}))))))}}]),t}(o.a.Component),Ae=a(9),Re=a(51),Me=a(220),_e="pk.eyJ1IjoiYWxtYWZlMjUxMCIsImEiOiJjbGdxandyNTcwcjAyM2htcms4d2p0bjdsIn0.CHmWlpKySeT-H08_G7a5gw",Fe="http://localhost:9000/api/v1",Ue={login:{url:"".concat(Fe,"/users"),method:"POST"},logout:{url:"".concat(Fe,"/logout"),method:"POST"},getDataset:{url:"".concat(Fe,"/getDataset"),method:"GET"},search:{url:"".concat(Fe,"/search"),method:"GET"},insert:{url:"".concat(Fe,"/insert"),method:"POST"},update:{url:"".concat(Fe,"/update"),method:"POST"},delete:{url:"".concat(Fe,"/delete"),method:"POST"}},Ne=function(e){for(var t in e)return!1;return!0},We=function(e){var t="GET"===e.method&&e.params?function(e,t){if(t){var a=[];return Object.keys(t).map(function(e){return a.push(e+"="+t[e]),!0}),e+"?"+a.join("&")}}(e.url,e.params):e.url;e.successCallback=e.successCallback||function(){},e.finallyCallback=e.finallyCallback||function(){},e.errorCallback=e.errorCallback||function(e){return f.emit("showSnackbar","error",e.toString())},e.failedCallback=e.failedCallback||function(e){e.authError&&(f.emit("login"),f.emit("setLoginState",!1)),f.emit("showSnackbar","error",e.errMsg)},fetch(t,{method:e.method,body:"POST"===e.method?JSON.stringify(e.params):void 0,credentials:e.credentials||"include"}).then(function(e){return e.json()}).then(function(t){return t.hasOwnProperty("success")&&!t.success?e.failedCallback(t):e.successCallback(t)}).finally(e.finallyCallback).catch(e.errorCallback)},ze=a(140),He=a.n(ze),Ve=(a(86),Object(O.b)({palette:{primary:{main:Y.a.A200}}})),Ge={root:{position:"fixed",top:74,right:10,borderRadius:4,minWidth:350,margin:0,width:900,zIndex:900},header:{backgroundColor:"#f1f1f1"},closeBtn:{position:"absolute",top:6,right:8,fontSize:22},searchField:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"2px 4px"},searchBox:{marginLeft:8,flex:1,border:"none !important"},searchBoxBtn:{padding:8},searchOptionsContainer:{padding:"5px 2px"},searchOption:{color:"rgba(0, 0, 0, 0.6)",cursor:"pointer"},searchBoxProgress:{marginRight:8},searchBoxDivider:{width:1,height:28,margin:4},resultWrapperOpen:{maxWidth:800},resultWrapperClosed:{maxWidth:350},resultContainer:{paddingTop:0,paddingBottom:0},resultTable:{boxShadow:"none"},uploadBoxInput:{display:"none"},uploadBoxBtnEdit:{width:40,height:40,lineHeight:"40px",textAlign:"center",borderRadius:"50%",fontSize:22},wrapBtn:{position:"absolute",bottom:12,left:18,padding:10,fontSize:24},addPointWrapperOpen:{maxWidth:350},addPointWrapperClose:{width:0},uploadBoxBtnAdd:{width:90,height:90,lineHeight:"90px",textAlign:"center",borderRadius:"50%",fontSize:30,backgroundColor:"rgba(0, 0, 0, 0.08)"},previewImageContainer:{display:"flex",alignItems:"center"},nameTextField:{margin:"0 20px 0 13px"},pinyinTextField:{margin:"10px 20px 10px 13px"},introTextField:{width:"100%",marginTop:5},locationImageContainer:{display:"flex",flexDirection:"column",alignItems:"center"},locationImage:{display:"block",marginTop:5,width:225,height:140,borderRadius:3,cursor:"pointer"},locationLabel:{display:"block",marginTop:6},actions:{paddingTop:10},saveBtn:{display:"inline-block",position:"relative",marginRight:10},saveBtnProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}},qe=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1,resultUnwrap:!1,addPointUnwrap:!1,optionsOpen:!1,searching:!1,submitting:!1,anchorEl:null,geometry:null,previewImage:null,previewMapUrl:null,previewCoordinate:{},loading:!0,traces:[],precipitationData:[],temperatureData:[],watsatData:[],animalData:[],items:[{id:1,title:"item #1"},{id:2,title:"item #2"},{id:3,title:"item #3"},{id:4,title:"item #4"},{id:5,title:"item #5"}],data:[],layout:{title:"Avistamientos de Animales por Localidad",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"N\xfamero de Avistamientos"},hovermode:"closest",plot_bgcolor:"white",paper_bgcolor:"white"},searchOptions:[{value:"gid",label:"Gid",checked:!0},{value:"name",label:"Name",checked:!0},{value:"pinyin",label:"Pinyin",checked:!0},{value:"introduction",label:"Introduction",checked:!1}]},a.initMaterialbox=function(){var e=document.querySelectorAll(".materialboxed");x.a.Materialbox.init(e,{onOpenStart:function(e){e.parentNode.style.overflow="visible"},onCloseEnd:function(e){e.parentNode.style.overflow="hidden"}})},a.resetPreviewImage=function(){a.setState({previewImage:null})},a.resetNewPointData=function(){a.setState({previewMapUrl:null,geometry:null,previewCoordinate:{}})},a.handleCloseClick=function(){a.setState({open:!1})},a.handleAddClick=function(){f.emit("getPoint"),a.handleWrapClick(),a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.fetchData=function(){fetch("http://localhost:5000/animales_por_localidad",{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){a.processAnimalSightings(e.output)}).catch(function(e){console.error("Error:",e),f.emit("showSnackbar","error","Error: Something happened extracting the data.")})},a.handleWrapClick=function(){f.emit("removeTempLayer"),a.resetPreviewImage(),document.getElementById("search-box").value="",a.setState({resultUnwrap:!1})},a.handleImageChange=function(e){e.target.files[0]&&(e.target.files[0].size>1048576?f.emit("showSnackbar","error","Error: Image must be smaller than 1MB."):a.state.reader.readAsDataURL(e.target.files[0]))},a.handleDoneEdit=function(){a.resetPreviewImage(),setTimeout(a.initMaterialbox,800)},a.handleSearchOptionsClick=function(){a.setState({optionsOpen:!0})},a.handleSearchOptionsClose=function(){a.setState({optionsOpen:!1})},a.handleSearchOptionChange=function(e){var t=null,n=!1;if(a.state.searchOptions.map(function(a){return a.value===e.currentTarget.value&&(a.checked=e.currentTarget.checked,t=a),n=n||a.checked,!0}),!n)return f.emit("showSnackbar","error","Error: Please select at least one option."),void(t.checked=!0);a.setState({searchOptions:a.state.searchOptions})},a.handleSearchClick=function(){a.handleCancelClick();var e=document.getElementById("search-box").value;if(e){a.setState({searching:!0});var t={};a.state.searchOptions.map(function(e){return t[e.value]=e.checked,!0}),We({url:Ue.search.url,method:Ue.search.method,params:{keyword:e,options:JSON.stringify(t)},successCallback:function(e){a.setState({addPointWrapperClose:!1,resultUnwrap:!0,data:e.data},a.initMaterialbox)},finallyCallback:function(){a.setState({searching:!1})}})}},a.handlePreviewClick=function(e,t){f.emit("displayTempLayer",t)},a.handlePreviewMapClick=function(){f.emit("getPoint"),a.setState({addPointUnwrap:!1})},a.handleSubmitClick=function(){f.emit("removeTempPoint"),a.setState({submitting:!0});var e={name:document.getElementById("name").value,pinyin:document.getElementById("pinyin").value,introduction:document.getElementById("introduction").value,image:a.state.previewImage?a.state.previewImage:{},geometry:a.state.geometry};We({url:Ue.insert.url,method:Ue.insert.method,params:e,successCallback:function(e){f.emit("showSnackbar","success","Insert new object with Gid = '".concat(e.gid,"' successfully.")),a.handleCancelClick()},finallyCallback:function(){a.setState({searching:!1,submitting:!1})}})},a.handleCancelClick=function(){f.emit("removeTempPoint"),document.getElementById("name").value="",document.getElementById("pinyin").value="",document.getElementById("introduction").value="",a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleRowUpdate=function(e,t){return new Promise(function(n){t.gid!==e.gid&&f.emit("showSnackbar","error","Column 'Gid' is readonly.");var o={gid:t.gid};a.state.previewImage?e.image=a.state.previewImage:e.image={},Object.keys(e).map(function(a){return"geometry"!==a&&e[a]!==t[a]&&(o[a]=e[a]),!0}),Ne(o)?f.emit("showSnackbar","default","Nothing to update."):We({url:Ue.update.url,method:Ue.update.method,params:o,successCallback:function(n){var o="Update ".concat(n.count," ").concat(n.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",o);var i=a.state.data;i[i.indexOf(t)]=e,a.setState({data:i})},finallyCallback:function(){n(),a.handleDoneEdit()}})})},a.handleRowDelete=function(e){return new Promise(function(t){We({url:Ue.delete.url,method:Ue.delete.method,params:{gid:e.gid},successCallback:function(t){var n="Delete ".concat(t.count," ").concat(t.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",n);var o=Object(Re.a)(a.state.data);o.splice(o.indexOf(e),1),a.setState(Object(fe.a)({},a.state,{data:o}))},finallyCallback:function(){t(),f.emit("removeTempLayer"),a.handleDoneEdit()}})})},a.processAnimalSightings=function(e){var t;try{if(t=JSON.parse(e),!Array.isArray(t))throw new Error("Parsed data is not an array")}catch(r){return console.error("Error parsing data:",r),void a.setState({loading:!1,error:"Invalid data format received"})}var n=function(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e},o=t.reduce(function(e,t){return Object.keys(t).forEach(function(t){"date"!==t&&"localidad"!==t&&e.add(t)}),e},new Set),i=Array.from(o).map(function(e){return{type:"bar",name:e,x:t.map(function(e){return new Date(e.date)}),y:t.map(function(t){return t[e]||0}),marker:{color:n()}}});a.setState({animalData:i,loading:!1})},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("anchorEl"),a=new FileReader;a.onload=function(t){var a=new Image;a.src=t.target.result;var n={longitude:a.height>a.width,src:t.target.result};e.setState({previewImage:n})},this.setState({reader:a,anchorEl:t}),this.openDataControllerListener=f.addListener("openDataController",function(){e.setState({open:!0})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})}),this.updatePointListener=f.addListener("setPoint",function(t,a,n){var o=Object(Ae.a)(t.geometry.coordinates,2),i=o[0],r=o[1],l="https://api.mapbox.com/styles/v1/".concat(a,"/static/pin-s+f00(").concat(i,",").concat(r,")/").concat(i,",").concat(r,",").concat(n,",0,1/250x155@2x?access_token=").concat(_e);e.setState({addPointUnwrap:!0,previewMapUrl:l,geometry:t,previewCoordinate:{lng:parseFloat(i).toFixed(3),lat:parseFloat(r).toFixed(3)}})})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openDataControllerListener),f.removeListener(this.closeAllControllerListener),f.removeListener(this.addPointListener),f.removeListener(this.updatePointListener),document.querySelectorAll(".materialboxed").map(function(e){return e.destory()})}},{key:"render",value:function(){var e=this.state,t=e.layout,a=e.animalData;return o.a.createElement(D.a,{theme:Ve},o.a.createElement(Z.a,{direction:"left",in:this.state.open},o.a.createElement(ce.a,{style:Ge.root},o.a.createElement(de.a,{style:Ge.header},o.a.createElement(Me.a,{enableSwipe:!1},o.a.createElement(He.a,{data:a,layout:t}))))))}}]),t}(o.a.Component),Je=a(205),Ze=a.n(Je),Ke=(a(321),a(206)),$e=a.n(Ke),Qe=a(207),Ye=a.n(Qe),Xe=a(53),et=a.n(Xe),tt=function(e){var t=e.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!t)return null;var a=function(e,t){return{center:[e,t],geometry:{type:"Point",coordinates:[e,t]},place_name:"Lat: "+t+" Lng: "+e,place_type:["coordinate"],properties:{},type:"Feature"}},n=Number(t[1]),o=Number(t[2]),i=[];return(n<-90||n>90)&&i.push(a(n,o)),(o<-90||o>90)&&i.push(a(o,n)),0===i.length&&(i.push(a(n,o)),i.push(a(o,n))),i},at={width:200,height:200,data:new Uint8Array(16e4),onAdd:function(e){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,this.context=t.getContext("2d"),this.map=e},render:function(){var e=this.context,t=performance.now()%1e3/1e3;return e.clearRect(0,0,this.width,this.height),e.beginPath(),e.arc(this.width/2,this.height/2,70*t+30,0,2*Math.PI),e.fillStyle="rgba(200, 200, 255,"+(1-t)+")",e.fill(),e.beginPath(),e.arc(this.width/2,this.height/2,30,0,2*Math.PI),e.fillStyle="rgba(100, 100, 255, 1)",e.strokeStyle="white",e.lineWidth=2+4*(1-t),e.fill(),e.stroke(),this.data=e.getImageData(0,0,this.width,this.height).data,this.map.triggerRepaint(),!0}};function nt(e){Object.assign(this.options,e),this._ticking=!1,this._lastMouseMoveEvent=null,this._parentMap=null,this._isDragging=!1,this._isCursorOverFeature=!1,this._previousPoint=[0,0],this._currentPoint=[0,0],this._trackingRectCoordinates=[[[],[],[],[],[]]]}nt.prototype=Object.assign({},et.a.NavigationControl.prototype,{options:{style:"mapbox://styles/almafe2510/clw7qv6il02ok01qr9w4wdbv0",center:[0,0]},onAdd:function(e){return this._container=this._createContainer(e),this._parentMap=e,this._miniMap=new et.a.Map({attributionControl:!1,container:this._container,style:this.options.style,center:this.options.center,zoom:0}),this._miniMap.on("load",this._load.bind(this)),this._container},_createContainer:function(e){var t=document.createElement("div");return t.id="minimap",t.className="mapboxgl-ctrl mapboxgl-ctrl-minimap",t.addEventListener("contextmenu",this._preventDefault),e.getContainer().appendChild(t),t},_preventDefault:function(e){e.preventDefault()},_load:function(){var e=this;this._zoomAdjust(),["dragPan","boxZoom","dragRotate","keyboard","doubleClickZoom","touchZoomRotate"].map(function(t){return e._miniMap[t].disable(),!0});var t=this._miniMap.getBounds();this._convertBoundsToPoints(t),this._miniMap.addSource("trackingRect",{type:"geojson",data:{type:"Feature",properties:{name:"trackingRect"},geometry:{type:"Polygon",coordinates:this._trackingRectCoordinates}}}),this._miniMap.addLayer({id:"trackingRectOutline",type:"line",source:"trackingRect",layout:{},paint:{"line-color":"#08F","line-width":1,"line-opacity":1}}),this._miniMap.addLayer({id:"trackingRectFill",type:"fill",source:"trackingRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.25}}),this._trackingRect=this._miniMap.getSource("trackingRect"),this._parentMap.on("move",this._update.bind(this)),this._parentMap.on("zoom",this._zoomAdjust.bind(this)),this._miniMap.on("mousemove",this._mouseMove.bind(this)),this._miniMap.on("mousedown",this._mouseDown.bind(this)),this._miniMap.on("mouseup",this._mouseUp.bind(this)),this._miniMap.on("touchmove",this._mouseMove.bind(this)),this._miniMap.on("touchstart",this._mouseDown.bind(this)),this._miniMap.on("touchend",this._mouseUp.bind(this)),this._miniMapCanvas=this._miniMap.getCanvasContainer(),this._miniMapCanvas.addEventListener("wheel",this._preventDefault),this._miniMapCanvas.addEventListener("mousewheel",this._preventDefault),this._update()},_mouseDown:function(e){this._isCursorOverFeature&&(this._isDragging=!0,this._previousPoint=this._currentPoint,this._currentPoint=[e.lngLat.lng,e.lngLat.lat])},_mouseUp:function(){this._isDragging=!1,this._ticking=!1},_mouseMove:function(e){this._ticking=!1;var t=this._miniMap.queryRenderedFeatures(e.point,{layers:["trackingRectFill"]});if((!this._isCursorOverFeature||t.length<=0)&&(this._isCursorOverFeature=t.length>0,this._miniMapCanvas.style.cursor=this._isCursorOverFeature?"move":""),this._isDragging){this._previousPoint=this._currentPoint,this._currentPoint=[e.lngLat.lng,e.lngLat.lat];var a=[this._currentPoint[0]-this._previousPoint[0],this._currentPoint[1]-this._previousPoint[1]],n=this._moveTrackingRect(a);this._parentMap.fitBounds(n,{duration:80,noMoveStart:!0})}},_moveTrackingRect:function(e){var t=this._trackingRect._data.properties.bounds;return t._ne.lng+=e[0],t._ne.lat+=e[1],t._sw.lng+=e[0],t._sw.lat+=e[1],this._convertBoundsToPoints(t),this._trackingRect.setData(this._trackingRect._data),t},_setTrackingRectBounds:function(e){this._convertBoundsToPoints(e),this._trackingRect._data.properties.bounds=e,this._trackingRect.setData(this._trackingRect._data)},_convertBoundsToPoints:function(e){this._trackingRectCoordinates[0][0][0]=e._ne.lng,this._trackingRectCoordinates[0][0][1]=e._ne.lat,this._trackingRectCoordinates[0][1][0]=e._sw.lng,this._trackingRectCoordinates[0][1][1]=e._ne.lat,this._trackingRectCoordinates[0][2][0]=e._sw.lng,this._trackingRectCoordinates[0][2][1]=e._sw.lat,this._trackingRectCoordinates[0][3][0]=e._ne.lng,this._trackingRectCoordinates[0][3][1]=e._sw.lat,this._trackingRectCoordinates[0][4][0]=e._ne.lng,this._trackingRectCoordinates[0][4][1]=e._ne.lat},_update:function(){if(!this._isDragging){var e=this._parentMap.getBounds();this._setTrackingRectBounds(e)}},_zoomAdjust:function(){var e=parseInt(this._parentMap.getZoom());this._miniMap.flyTo({center:this._parentMap.getCenter(),zoom:e<4?0:e-3,bearing:0})}});var ot=nt,it=(a(350),{root:{width:"100%",position:"fixed",top:64,bottom:0}}),rt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).removeTempLayer=function(){var e=a.state.map.getStyle().layers;console.log(e),a.setState({map:null}),e.map(function(e){return"custom-temp-point"===e.id&&(a.state.map.removeLayer("custom-temp-point"),a.state.map.removeSource("custom-temp-point")),!0}),a.state.popup.isOpen()&&a.state.popup.remove()},a.removeAllLayer=function(){var e=a.state.map.getStyle().layers;e.map(function(e){return e.id.includes("-points")&&(a.state.map.removeLayer(e.id),a.state.map.removeSource(e.source)),!0}),e.map(function(e){return e.id.includes("-boundary")&&(a.state.map.removeLayer(e.id),a.state.map.removeSource(e.source)),!0}),a.state.popup.isOpen()&&a.state.popup.remove(),f.emit("handleDatasetRemove")},a.add3dLayer=function(){var e=a.state.map.getStyle().layers;for(var t in e)if("symbol"===t.type&&t.layout["text-field"]){var n=t.id;break}a.state.map.getLayer("3d-buildings")?a.state.map.moveLayer("3d-buildings",n):a.state.map.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:12,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.6}},n)},a.removeTempPoint=function(){a.state.draw.delete(a.state.tempId),a.setState({tempId:null})},a.moveMAP=function(){var e=a.state.map;console.log(e),a.setState({movedMAP:e}),console.log(a.state.movedMAP)},a.handleURLMoved=function(e){console.log("Received moved data:",e),a.removeAllLayer(),a.setState({url:e.output[0]}),console.log(e.output[0]),a.state.map.addLayer({id:"predictedSOC",type:"raster",source:{type:"raster",tiles:[a.state.url],tileSize:256},paint:{"raster-opacity":.8}}),a.updateLegend(e.output[1]),f.emit("moveMAP",a.state.map)},a.updateLegend=function(e){var t=e.min,a=e.max,n=e.palette,o=document.getElementById("legend");if(o){o.innerHTML="";var i=n.length,r=(a-t)/(i-1);n.forEach(function(e,a){var n=(t+r*a).toFixed(2),i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.marginBottom="5px",i.innerHTML='<i style="background: '.concat(e,'; width: 20px; height: 20px; display: inline-block; margin-right: 8px;"></i> <span style="font-size: 12px;">').concat(n,"</span>"),o.appendChild(i)}),o.style.position="fixed",o.style.bottom="10px",o.style.left="10px",o.style.width="150px",o.style.backgroundColor="rgba(255, 255, 255, 0.8)",o.style.border="2px solid grey",o.style.borderRadius="8px",o.style.padding="10px",o.style.fontSize="12px",o.style.zIndex="9999",o.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.5)"}else console.error("Legend element not found")},a.fetchData=function(){},a.mapContainer=o.a.createRef(),a.state={map:null,draw:null,minimap:null,popup:null,gettingPoint:null,tempId:null,styleCode:Object.values(me)[0].substring(16)},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"flyToGeometry",value:function(e,t){var a,n=t.type;if("FeatureCollection"===n){var o=t.features[0];console.log(o),a=o.geometry.coordinates}else a="Feature"===n?t.geometry.coordinates:t.coordinates;"Polygon"===t.features[0].geometry.type?(console.log(a),this.state.map.flyTo({center:a[0][0],zoom:15})):"Point"===t.features[0].geometry.type&&this.state.map.flyTo({center:a,zoom:17})}},{key:"componentDidMount",value:function(){var e=this;if(et.a.accessToken=_e,et.a.supported()){var t=new et.a.Map({container:this.mapContainer.current,style:Object.values(me)[1],center:[-6.002481,37.377469],zoom:17,antialias:!0}),a=new Ze.a({controls:{combine_features:!1,uncombine_features:!1}}),n=new ot({center:t.getCenter()});t.addControl(new $e.a({accessToken:et.a.accessToken,mapboxgl:et.a,localGeocoder:tt,placeholder:"Search Address",marker:{color:"red"}}),"top-left"),t.addControl(new et.a.NavigationControl,"top-left"),t.addControl(new et.a.GeolocateControl,"top-left"),t.addControl(new Ye.a({trafficSource:new RegExp("/*/")}),"top-left"),t.addControl(a,"top-left"),t.addControl(n,"bottom-left");var o=new et.a.Popup({closeButton:!1,anchor:"bottom"}).setHTML('<div id="popup-container"></div>');document.getElementsByClassName("mapboxgl-ctrl-geocoder--input")[0].setAttribute("type","search-box"),t.on("load",function(){e.add3dLayer(),document.getElementById("loader-wrapper").classList.add("loaded")}),t.on("click",function(e){var t=e.lngLat,a=t.lng,n=t.lat;console.log("Longitude: ".concat(a,", Latitude: ").concat(n))}),t.on("zoomend",function(){var e=t.getZoom();f.emit("setMapZoom",e)}),t.on("draw.create",function(t){e.state.gettingPoint&&(e.setState({tempId:t.features[0].id}),f.emit("setPoint",t.features[0],e.state.styleCode,e.state.map.getZoom()),e.setState({gettingPoint:!1}))}),this.fetchData(),this.setMapStyleListener=f.addListener("setMapStyle",function(t){e.state.popup.isOpen()&&e.state.popup.remove(),e.state.map.setStyle(me[t]);var a=new ot({center:e.state.map.getCenter(),style:Object.values(me)[1]});e.state.map.removeControl(e.state.minimap),e.state.map.addControl(a,"bottom-left"),e.setState({minimap:a,styleCode:me[t].substring(16)})}),this.displayDatasetListener=f.addListener("displayDataset",function(a,n){e.state.map.getSource(a)&&e.state.map.removeSource(a),t.addSource(a,{type:"geojson",data:n}),t.addLayer({id:a+"-boundary",type:"fill",source:a,paint:{"fill-color":"#888888","fill-opacity":.4},filter:["==","$type","Polygon"]}),t.addLayer({id:a+"-points",type:"circle",source:a,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","$type","Point"]}),e.flyToGeometry(t,n)}),this.removeDatasetListener=f.addListener("removeDataset",function(t){[t+"-boundary",t+"-points"].forEach(function(t){e.state.map.getLayer(t)&&(console.log("Removing layer and source:",t),e.state.map.removeLayer(t))}),e.state.map.getSource(t)&&e.state.map.removeSource(t)}),this.moveLayerListener=f.addListener("moveLayer",function(t,a){a?e.state.map.moveLayer(t,a):e.state.map.moveLayer(t)}),this.displayTempLayerListener=f.addListener("displayTempLayer",function(t){e.removeTempLayer(),e.state.map.hasImage("marker")||e.state.map.addImage("marker",at,{pixelRatio:3}),e.state.map.addLayer({id:"custom-temp-point",type:"symbol",source:{type:"geojson",data:t.geometry},layout:{"icon-image":"marker"}}),e.state.popup.setLngLat(t.geometry.geometry.coordinates).addTo(e.state.map),f.emit("bindPopup",t),e.state.map.flyTo({center:t.geometry.geometry.coordinates,zoom:6,bearing:0})}),this.removeAllLayerListener=f.addListener("removeAllLayer",function(){e.removeAllLayer()}),this.removeTempLayerListener=f.addListener("removeTempLayer",function(){e.removeTempLayer()}),this.getPointListener=f.addListener("getPoint",function(){e.removeTempPoint(),e.state.draw.changeMode("draw_point"),f.emit("showSnackbar","default","Click on the map to select a point."),e.setState({gettingPoint:!0})}),this.removeTempPointListener=f.addListener("removeTempPoint",function(){e.removeTempPoint()}),this.setState({map:t,draw:a,style:Object.values(me)[1],minimap:n,popup:o}),this.moveMAPistener=f.addListener("moveMAP",function(){console.log("MAP"),e.moveMAP()}),f.on("moveURL",this.handleURLMoved)}else alert("Your browser does not support Mapbox GL")}},{key:"componentWillUnmount",value:function(){f.removeListener(this.setMapStyleListener),f.removeListener(this.displayDatasetListener),f.removeListener(this.removeDatasetListener),f.removeListener(this.moveLayerListener),f.removeListener(this.displayTempLayerListener),f.removeListener(this.removeTempLayerListener),f.removeListener(this.removeAllLayerListener),f.removeListener(this.getPointListener),f.removeListener(this.removeTempPointListener),f.removeListener(this.moveMAPistener)}},{key:"render",value:function(){return o.a.createElement("div",{id:"map",style:it.root,ref:this.mapContainer},o.a.createElement("div",{id:"legend"}))}}]),t}(o.a.Component),lt=a(446),st={root:{minWidth:320,maxWidth:345},image:{height:140},titleContainer:{display:"flex",alignItems:"space-between",padding:"5px 16px 2px"},titleContainerEnd:{display:"flex",alignItems:"space-between",padding:"5px 16px 10px"},nameContainer:{display:"flex",flexDirection:"column",justifyContent:"flex-end",height:65},popupName:{display:"inline-block"},popupPinyin:{display:"inline-block"},weatherWidgetContainer:{position:"absolute",right:0,width:155},introductionContainer:{paddingTop:5},popupIntroduction:{wordWrap:"break-word",wordBreak:"break-all"}},ct=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1,data:{}},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.bindPopupListener=f.addListener("bindPopup",function(t){var a=document.getElementById("popup");document.getElementById("popup-container").appendChild(a);var n=document.createElement("script");n.type="text/javascript",n.src="https://darksky.net/widget/default-small/".concat(t.geometry.geometry.coordinates[1].toString(),",").concat(t.geometry.geometry.coordinates[0].toString(),"/ca12/en.js?height=60"),document.getElementById("customize-script-container").appendChild(n),e.setState({open:!0,data:t})})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.bindPopupListener)}},{key:"render",value:function(){return o.a.createElement(ce.a,{id:"popup",style:st.root,className:this.state.open?null:"hidden"},o.a.createElement(lt.a,{className:this.state.data.image&&this.state.data.image.src?null:"hidden",style:st.image,image:this.state.data.image&&this.state.data.image.src?this.state.data.image.src:"#"}),o.a.createElement(de.a,{style:this.state.data.introduction?st.titleContainer:st.titleContainerEnd},o.a.createElement("div",{style:st.nameContainer},o.a.createElement($.a,{style:st.popupName,variant:"h5",component:"h2"},this.state.data.name),o.a.createElement($.a,{style:st.popupPinyin,variant:"subtitle1",color:"textSecondary",component:"h3"},this.state.data.pinyin)),o.a.createElement("div",{id:"customize-script-container",style:st.weatherWidgetContainer})),o.a.createElement(de.a,{style:st.introductionContainer,className:this.state.data.introduction?null:"hidden"},o.a.createElement($.a,{style:st.popupIntroduction,variant:"body2",color:"textSecondary",component:"p"},this.state.data.introduction)))}}]),t}(o.a.Component),dt=(a(351),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1,resultUnwrap:!1,addPointUnwrap:!1,optionsOpen:!1,searching:!1,submitting:!1,anchorEl:null,geometry:null,previewImage:null,previewMapUrl:null,previewCoordinate:{},data:[],searchOptions:[{value:"gid",label:"Gid",checked:!0},{value:"name",label:"Name",checked:!0},{value:"pinyin",label:"Pinyin",checked:!0},{value:"introduction",label:"Introduction",checked:!1}]},a.initMaterialbox=function(){var e=document.querySelectorAll(".materialboxed");x.a.Materialbox.init(e,{onOpenStart:function(e){e.parentNode.style.overflow="visible"},onCloseEnd:function(e){e.parentNode.style.overflow="hidden"}})},a.resetPreviewImage=function(){a.setState({previewImage:null})},a.resetNewPointData=function(){a.setState({previewMapUrl:null,geometry:null,previewCoordinate:{}})},a.handleCloseClick=function(){a.setState({open:!1})},a.handleAddClick=function(){f.emit("getPoint"),a.handleWrapClick(),a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleWrapClick=function(){f.emit("removeTempLayer"),a.resetPreviewImage(),document.getElementById("search-box").value="",a.setState({resultUnwrap:!1})},a.handleImageChange=function(e){e.target.files[0]&&(e.target.files[0].size>1048576?f.emit("showSnackbar","error","Error: Image must be smaller than 1MB."):a.state.reader.readAsDataURL(e.target.files[0]))},a.handleDoneEdit=function(){a.resetPreviewImage(),setTimeout(a.initMaterialbox,800)},a.handleSearchOptionsClick=function(){a.setState({optionsOpen:!0})},a.handleSearchOptionsClose=function(){a.setState({optionsOpen:!1})},a.handleSearchOptionChange=function(e){var t=null,n=!1;if(a.state.searchOptions.map(function(a){return a.value===e.currentTarget.value&&(a.checked=e.currentTarget.checked,t=a),n=n||a.checked,!0}),!n)return f.emit("showSnackbar","error","Error: Please select at least one option."),void(t.checked=!0);a.setState({searchOptions:a.state.searchOptions})},a.handleSearchClick=function(){a.handleCancelClick();var e=document.getElementById("search-box").value;if(e){a.setState({searching:!0});var t={};a.state.searchOptions.map(function(e){return t[e.value]=e.checked,!0}),We({url:Ue.search.url,method:Ue.search.method,params:{keyword:e,options:JSON.stringify(t)},successCallback:function(e){a.setState({addPointWrapperClose:!1,resultUnwrap:!0,data:e.data},a.initMaterialbox)},finallyCallback:function(){a.setState({searching:!1})}})}},a.handlePreviewClick=function(e,t){f.emit("displayTempLayer",t)},a.handlePreviewMapClick=function(){f.emit("getPoint"),a.setState({addPointUnwrap:!1})},a.handleSubmitClick=function(){f.emit("removeTempPoint"),a.setState({submitting:!0});var e={name:document.getElementById("name").value,pinyin:document.getElementById("pinyin").value,introduction:document.getElementById("introduction").value,image:a.state.previewImage?a.state.previewImage:{},geometry:a.state.geometry};We({url:Ue.insert.url,method:Ue.insert.method,params:e,successCallback:function(e){f.emit("showSnackbar","success","Insert new object with Gid = '".concat(e.gid,"' successfully.")),a.handleCancelClick()},finallyCallback:function(){a.setState({searching:!1,submitting:!1})}})},a.handleCancelClick=function(){f.emit("removeTempPoint"),document.getElementById("name").value="",document.getElementById("pinyin").value="",document.getElementById("introduction").value="",a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleRowUpdate=function(e,t){return new Promise(function(n){t.gid!==e.gid&&f.emit("showSnackbar","error","Column 'Gid' is readonly.");var o={gid:t.gid};a.state.previewImage?e.image=a.state.previewImage:e.image={},Object.keys(e).map(function(a){return"geometry"!==a&&e[a]!==t[a]&&(o[a]=e[a]),!0}),Ne(o)?f.emit("showSnackbar","default","Nothing to update."):We({url:Ue.update.url,method:Ue.update.method,params:o,successCallback:function(n){var o="Update ".concat(n.count," ").concat(n.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",o);var i=a.state.data;i[i.indexOf(t)]=e,a.setState({data:i})},finallyCallback:function(){n(),a.handleDoneEdit()}})})},a.handleRowDelete=function(e){return new Promise(function(t){We({url:Ue.delete.url,method:Ue.delete.method,params:{gid:e.gid},successCallback:function(t){var n="Delete ".concat(t.count," ").concat(t.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",n);var o=Object(Re.a)(a.state.data);o.splice(o.indexOf(e),1),a.setState(Object(fe.a)({},a.state,{data:o}))},finallyCallback:function(){t(),f.emit("removeTempLayer"),a.handleDoneEdit()}})})},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("anchorEl"),a=new FileReader;a.onload=function(t){var a=new Image;a.src=t.target.result;var n={longitude:a.height>a.width,src:t.target.result};e.setState({previewImage:n})},this.setState({reader:a,anchorEl:t}),this.openSyncControllerListener=f.addListener("openSyncController",function(){e.setState({open:!0}),fetch("http://localhost:5000/run-script",{method:"POST",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){console.log(e),f.emit("showSnackbar","success","Database synchronised.")}).catch(function(e){f.emit("showSnackbar","error","Error: Database synchronised."),console.error("Error:",e)})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})}),this.updatePointListener=f.addListener("setPoint",function(t,a,n){var o=Object(Ae.a)(t.geometry.coordinates,2),i=o[0],r=o[1],l="https://api.mapbox.com/styles/v1/".concat(a,"/static/pin-s+f00(").concat(i,",").concat(r,")/").concat(i,",").concat(r,",").concat(n,",0,1/250x155@2x?access_token=").concat(_e);e.setState({addPointUnwrap:!0,previewMapUrl:l,geometry:t,previewCoordinate:{lng:parseFloat(i).toFixed(3),lat:parseFloat(r).toFixed(3)}})})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openDataControllerListener),f.removeListener(this.closeAllControllerListener),f.removeListener(this.addPointListener),f.removeListener(this.updatePointListener),document.querySelectorAll(".materialboxed").map(function(e){return e.destory()})}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null)}}]),t}(o.a.Component)),ut=Object(O.b)({palette:{primary:{main:Y.a.A200}}}),mt={root:{position:"fixed",top:74,right:10,borderRadius:4,minWidth:350,margin:0,zIndex:900},header:{backgroundColor:"#f1f1f1"},closeBtn:{position:"absolute",top:6,right:8,fontSize:22},searchField:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"2px 4px"},searchBox:{marginLeft:8,flex:1,border:"none !important"},searchBoxBtn:{padding:8},searchOptionsContainer:{padding:"5px 2px"},searchOption:{color:"rgba(0, 0, 0, 0.6)",cursor:"pointer"},searchBoxProgress:{marginRight:8},searchBoxDivider:{width:1,height:28,margin:4},resultWrapperOpen:{maxWidth:800},resultWrapperClosed:{maxWidth:350},resultContainer:{paddingTop:0,paddingBottom:0},resultTable:{boxShadow:"none"},uploadBoxInput:{display:"none"},uploadBoxBtnEdit:{width:40,height:40,lineHeight:"40px",textAlign:"center",borderRadius:"50%",fontSize:22},wrapBtn:{position:"absolute",bottom:12,left:18,padding:10,fontSize:24},addPointWrapperOpen:{maxWidth:350},addPointWrapperClose:{width:0},uploadBoxBtnAdd:{width:90,height:90,lineHeight:"90px",textAlign:"center",borderRadius:"50%",fontSize:30,backgroundColor:"rgba(0, 0, 0, 0.08)"},previewImageContainer:{display:"flex",alignItems:"center"},nameTextField:{margin:"0 20px 0 13px"},pinyinTextField:{margin:"10px 20px 10px 13px"},introTextField:{width:"100%",marginTop:5},locationImageContainer:{display:"flex",flexDirection:"column",alignItems:"center"},locationImage:{display:"block",marginTop:5,width:225,height:140,borderRadius:3,cursor:"pointer"},locationLabel:{display:"block",marginTop:6},actions:{paddingTop:10},saveBtn:{display:"inline-block",position:"relative",marginRight:10},saveBtnProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}},pt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={Ic:0,Ih:0,Ig:0,Io:0,If:0,IoType:0,sustainabilityIndex:null,decision:null,open:!1,resultUnwrap:!1,addPointUnwrap:!1,optionsOpen:!1,searching:!1,submitting:!1,anchorEl:null,geometry:null,previewImage:null,previewMapUrl:null,previewCoordinate:{},loading:!0,traces:[],precipitationData:[],temperatureData:[],watsatData:[],layoutTemperature:{title:"Temperatura del Aire HC",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Temperatura (\xb0C)"}},layoutPrecipitation:{title:"Precipitaci\xf3n",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Precipitaci\xf3n (mm)"}},layoutWatsat:{title:"Modelo Watsat",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Contenido Volum\xe9trico de Agua"}},layout:{barmode:"stack",title:"Avistamientos de insectos por d\xeda",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Cantidad"}},items:[{id:1,title:"item #1"},{id:2,title:"item #2"},{id:3,title:"item #3"},{id:4,title:"item #4"},{id:5,title:"item #5"}],data:[],searchOptions:[{value:"gid",label:"Gid",checked:!0},{value:"name",label:"Name",checked:!0},{value:"pinyin",label:"Pinyin",checked:!0},{value:"introduction",label:"Introduction",checked:!1}]},a.calculateSustainabilityIndex=function(){var e=1===a.state.Io?a.state.IoType:0,t=2.45*a.state.Ic+2.18*a.state.Ih+1.64*a.state.Ig+1.09*e+1*a.state.If;a.setState({sustainabilityIndex:t})},a.handleDecision=function(e){a.setState({decision:e})},a.initMaterialbox=function(){var e=document.querySelectorAll(".materialboxed");x.a.Materialbox.init(e,{onOpenStart:function(e){e.parentNode.style.overflow="visible"},onCloseEnd:function(e){e.parentNode.style.overflow="hidden"}})},a.resetPreviewImage=function(){a.setState({previewImage:null})},a.resetNewPointData=function(){a.setState({previewMapUrl:null,geometry:null,previewCoordinate:{}})},a.handleCloseClick=function(){a.setState({open:!1})},a.handleAddClick=function(){f.emit("getPoint"),a.handleWrapClick(),a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleWrapClick=function(){f.emit("removeTempLayer"),a.resetPreviewImage(),document.getElementById("search-box").value="",a.setState({resultUnwrap:!1})},a.handleImageChange=function(e){e.target.files[0]&&(e.target.files[0].size>1048576?f.emit("showSnackbar","error","Error: Image must be smaller than 1MB."):a.state.reader.readAsDataURL(e.target.files[0]))},a.handleDoneEdit=function(){a.resetPreviewImage(),setTimeout(a.initMaterialbox,800)},a.handleSearchOptionsClick=function(){a.setState({optionsOpen:!0})},a.handleSearchOptionsClose=function(){a.setState({optionsOpen:!1})},a.handleSearchOptionChange=function(e){var t=null,n=!1;if(a.state.searchOptions.map(function(a){return a.value===e.currentTarget.value&&(a.checked=e.currentTarget.checked,t=a),n=n||a.checked,!0}),!n)return f.emit("showSnackbar","error","Error: Please select at least one option."),void(t.checked=!0);a.setState({searchOptions:a.state.searchOptions})},a.handleSearchClick=function(){a.handleCancelClick();var e=document.getElementById("search-box").value;if(e){a.setState({searching:!0});var t={};a.state.searchOptions.map(function(e){return t[e.value]=e.checked,!0}),We({url:Ue.search.url,method:Ue.search.method,params:{keyword:e,options:JSON.stringify(t)},successCallback:function(e){a.setState({addPointWrapperClose:!1,resultUnwrap:!0,data:e.data},a.initMaterialbox)},finallyCallback:function(){a.setState({searching:!1})}})}},a.handlePreviewClick=function(e,t){f.emit("displayTempLayer",t)},a.handlePreviewMapClick=function(){f.emit("getPoint"),a.setState({addPointUnwrap:!1})},a.handleSelectChange=function(e){a.setState(Object(ge.a)({},e.target.name,Number(e.target.value)))},a.calculateSustainabilityIndex=function(){var e=a.state,t=e.Ic,n=e.Ih,o=e.Ig,i=e.Io,r=e.If,l=e.IoType,s=2.45*t+2.18*n+1.64*o+1.09*(1===i?l:0)+1*r;a.setState({sustainabilityIndex:s})},a.handleSubmitClick=function(){f.emit("removeTempPoint"),a.setState({submitting:!0});var e={name:document.getElementById("name").value,pinyin:document.getElementById("pinyin").value,introduction:document.getElementById("introduction").value,image:a.state.previewImage?a.state.previewImage:{},geometry:a.state.geometry};We({url:Ue.insert.url,method:Ue.insert.method,params:e,successCallback:function(e){f.emit("showSnackbar","success","Insert new object with Gid = '".concat(e.gid,"' successfully.")),a.handleCancelClick()},finallyCallback:function(){a.setState({searching:!1,submitting:!1})}})},a.handleCancelClick=function(){f.emit("removeTempPoint"),document.getElementById("name").value="",document.getElementById("pinyin").value="",document.getElementById("introduction").value="",a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleRowUpdate=function(e,t){return new Promise(function(n){t.gid!==e.gid&&f.emit("showSnackbar","error","Column 'Gid' is readonly.");var o={gid:t.gid};a.state.previewImage?e.image=a.state.previewImage:e.image={},Object.keys(e).map(function(a){return"geometry"!==a&&e[a]!==t[a]&&(o[a]=e[a]),!0}),Ne(o)?f.emit("showSnackbar","default","Nothing to update."):We({url:Ue.update.url,method:Ue.update.method,params:o,successCallback:function(n){var o="Update ".concat(n.count," ").concat(n.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",o);var i=a.state.data;i[i.indexOf(t)]=e,a.setState({data:i})},finallyCallback:function(){n(),a.handleDoneEdit()}})})},a.handleRowDelete=function(e){return new Promise(function(t){We({url:Ue.delete.url,method:Ue.delete.method,params:{gid:e.gid},successCallback:function(t){var n="Delete ".concat(t.count," ").concat(t.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",n);var o=Object(Re.a)(a.state.data);o.splice(o.indexOf(e),1),a.setState(Object(fe.a)({},a.state,{data:o}))},finallyCallback:function(){t(),f.emit("removeTempLayer"),a.handleDoneEdit()}})})},a.processTemperatureData=function(e){var t={type:"scatter",mode:"lines",x:e.map(function(e){return new Date(e.sampling_date)}),y:e.map(function(e){return e.measurement_value}),name:"Temperatura del Aire HC"};a.setState({temperatureData:[t],loading:!1})},a.processPrecipitationData=function(e){var t={type:"scatter",mode:"lines",x:e.map(function(e){return new Date(e.sampling_date)}),y:e.map(function(e){return e.measurement_value}),name:"Precipitaci\xf3n"};a.setState({precipitationData:[t],loading:!1})},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("anchorEl"),a=new FileReader;a.onload=function(t){var a=new Image;a.src=t.target.result;var n={longitude:a.height>a.width,src:t.target.result};e.setState({previewImage:n})},this.setState({reader:a,anchorEl:t}),this.openTreeControllerListener=f.addListener("openTreeController",function(){e.setState({open:!0})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})}),this.updatePointListener=f.addListener("setPoint",function(t,a,n){var o=Object(Ae.a)(t.geometry.coordinates,2),i=o[0],r=o[1],l="https://api.mapbox.com/styles/v1/".concat(a,"/static/pin-s+f00(").concat(i,",").concat(r,")/").concat(i,",").concat(r,",").concat(n,",0,1/250x155@2x?access_token=").concat(_e);e.setState({addPointUnwrap:!0,previewMapUrl:l,geometry:t,previewCoordinate:{lng:parseFloat(i).toFixed(3),lat:parseFloat(r).toFixed(3)}})})}},{key:"setIc",value:function(e){this.setState({Ic:e})}},{key:"setIh",value:function(e){this.setState({Ih:e})}},{key:"setIg",value:function(e){this.setState({Ig:e})}},{key:"setIo",value:function(e){this.setState({Io:e})}},{key:"setIoType",value:function(e){this.setState({IoType:e})}},{key:"setIf",value:function(e){this.setState({If:e})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openTreeControllerListener),f.removeListener(this.closeAllControllerListener),f.removeListener(this.addPointListener),f.removeListener(this.updatePointListener),document.querySelectorAll(".materialboxed").map(function(e){return e.destory()})}},{key:"render",value:function(){var e=this.state,t=e.open,a=e.Ic,n=e.Ih,i=e.Ig,r=e.Io,l=e.If,s=e.IoType,c=e.sustainabilityIndex;return o.a.createElement(D.a,{theme:ut},o.a.createElement(Z.a,{direction:"left",in:t},o.a.createElement(ce.a,{style:mt.root},o.a.createElement(de.a,{style:mt.header},o.a.createElement($.a,{variant:"h5",gutterBottom:!0},"\xc1rbol de Decisi\xf3n para la Sostenibilidad del Olivar"),o.a.createElement(ye.a,{fullWidth:!0,margin:"normal"},o.a.createElement(be.a,null,"\xbfMantiene una cubierta vegetal en el suelo de su olivar?"),o.a.createElement(xe.a,{name:"Ic",value:a,onChange:this.handleSelectChange},o.a.createElement(we.a,{value:0},"No"),o.a.createElement(we.a,{value:1},"En bandas"),o.a.createElement(we.a,{value:2},"Toda la superficie menos los ruedos"),o.a.createElement(we.a,{value:3},"Toda la superficie, incluyendo los ruedos"))),o.a.createElement(ye.a,{fullWidth:!0,margin:"normal"},o.a.createElement(be.a,null,"\xbfConserva alg\xfan tipo de vegetaci\xf3n natural en su olivar?"),o.a.createElement(xe.a,{name:"Ih",value:n,onChange:this.handleSelectChange},o.a.createElement(we.a,{value:0},"No"),o.a.createElement(we.a,{value:1},"Conservo algunos \xe1rboles dispersos"),o.a.createElement(we.a,{value:2},"Conservo parches de vegetaci\xf3n natural"),o.a.createElement(we.a,{value:3},"Conservo una o varias manchas importantes de monte mediterr\xe1neo"))),o.a.createElement(ye.a,{fullWidth:!0,margin:"normal"},o.a.createElement(be.a,null,"\xbfSuele incorporar ganado a pastar dentro de su olivar?"),o.a.createElement(xe.a,{name:"Ig",value:i,onChange:this.handleSelectChange},o.a.createElement(we.a,{value:0},"No"),o.a.createElement(we.a,{value:1},"S\xed"))),o.a.createElement(ye.a,{fullWidth:!0,margin:"normal"},o.a.createElement(be.a,null,"\xbfSuministra a sus suelos alg\xfan tipo de fertilizante org\xe1nico?"),o.a.createElement(xe.a,{name:"Io",value:r,onChange:this.handleSelectChange},o.a.createElement(we.a,{value:0},"No"),o.a.createElement(we.a,{value:1},"S\xed")),1===r&&o.a.createElement(ye.a,{fullWidth:!0,margin:"normal"},o.a.createElement(be.a,null,"\xbfCu\xe1l de los siguientes fertilizantes org\xe1nicos emplea?"),o.a.createElement(xe.a,{name:"IoType",value:s,onChange:this.handleSelectChange},o.a.createElement(we.a,{value:1},"Restos triturados de la poda"),o.a.createElement(we.a,{value:1},"Alperujo compostado"),o.a.createElement(we.a,{value:1},"Esti\xe9rcol"),o.a.createElement(we.a,{value:1},"Otros tipos"),o.a.createElement(we.a,{value:2},"Dos de los anteriores"),o.a.createElement(we.a,{value:3},"Tres o m\xe1s de los anteriores")))),o.a.createElement(ye.a,{fullWidth:!0,margin:"normal"},o.a.createElement(be.a,null,"\xbfCu\xe1l de los siguientes productos fitosanitarios NO aplica en su olivar?"),o.a.createElement(xe.a,{name:"If",value:l,onChange:this.handleSelectChange},o.a.createElement(we.a,{value:0},"Aplico todos los anteriores"),o.a.createElement(we.a,{value:1},"No aplico fungicidas"),o.a.createElement(we.a,{value:2},"No aplico herbicidas"),o.a.createElement(we.a,{value:3},"No aplico pesticidas"))),o.a.createElement(g.a,{variant:"contained",color:"primary",onClick:this.calculateSustainabilityIndex,style:{marginTop:20}},"Calcular \xcdndice de Sostenibilidad"),null!==c&&o.a.createElement($.a,{variant:"h6",style:{marginTop:20}},"\xcdndice de Sostenibilidad: ",c.toFixed(2)),o.a.createElement(I.a,{style:mt.closeBtn,"aria-label":"Close",onClick:this.handleCloseClick},o.a.createElement(L.a,{fontSize:"inherit"},"chevron_right"))))))}}]),t}(o.a.Component),ht=a(182),gt=a(379),ft=a(447),vt=a(448),yt=a(449),bt=a(450),xt=a(73),Ct=a(463),Et=a(452),wt=a(451),kt=a(52),St=a.n(kt),It=a(98),Lt=Object(ht.a)(function(e){return{root:{width:"100%","& .MuiDropzoneArea-root":{minHeight:"100px",maxHeight:"200px"}},fileDetails:{marginTop:e.spacing(1)},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0,fontWeight:"bold"},secondaryHeading:{fontSize:e.typography.pxToRem(15),color:e.palette.text.secondary},checkBoxContainer:{display:"flex",flexDirection:"row",justifyContent:"center",flexWrap:"wrap"},formControl:{margin:e.spacing(1),minWidth:120,width:"100%"},inputLabel:{marginBottom:e.spacing(1)},dateInput:{width:"100%",marginTop:e.spacing(2),marginBottom:e.spacing(2)},foormControl:{margin:e.spacing(3)},dropzone:{minHeight:"191px"},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},progressText:{marginLeft:e.spacing(2)}}});function Ot(e){var t=e.onSubmit,a=Lt(),i=Object(n.useState)([]),r=Object(Ae.a)(i,2),l=(r[0],r[1]),s=Object(n.useState)(""),c=Object(Ae.a)(s,2),d=(c[0],c[1],Object(n.useState)("rf")),u=Object(Ae.a)(d,2),m=(u[0],u[1]),p=Object(n.useState)(!1),h=Object(Ae.a)(p,2),f=h[0],v=h[1],y=Object(n.useState)({rf:!1,svm:!1,knn:!1,aoiDataFiles:[],startDate:"2024-04-14",endDate:"2024-05-14",satelliteData:{sentinel1:!1,sentinel2:!1,landsat:!1},indexes:{vegetationIndexes:!1,brightnessIndexes:!1,moistureIndexes:!1},modelFeatures:{numberOfTrees:500,seed:1e-4,bagFraction:0},performanceIndicators:{rsquare:!1,rmse:!1,mse:!1,mae:!1,rpiq:!1}}),b=Object(Ae.a)(y,2),x=b[0],C=b[1],E=Object(n.useState)(!1),w=Object(Ae.a)(E,2),k=w[0],S=w[1],I=Object(n.useState)(0),L=Object(Ae.a)(I,2),O=L[0],D=L[1];Object(n.useEffect)(function(){var e;return k?e=setInterval(function(){D(function(e){return e+1})},1e3):clearInterval(e),function(){return clearInterval(e)}},[k]);var j=function(e){return function(t,a){v(!!a&&e)}},P=function(e){var t=e.target,a=t.name,n=t.value,o=t.checked,i=t.type;C(function(e){return Object(fe.a)({},e,Object(ge.a)({},a,"checkbox"===i||"radio"===i?o:n))}),"options"===a&&m(n)},T=function(){var e=Object(z.a)(W.a.mark(function e(){var a,n,o,i,r,l,s;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n in e.prev=0,S(!0),D(0),(a=new FormData).append("aoiDataFiles",x.aoiDataFiles[0]),x.satelliteData)a.append(n,x.satelliteData[n]);for(o in x.indexes)a.append(o,x.indexes[o]);for(i in x.modelFeatures)a.append(i,x.modelFeatures[i]);for(r in x.performanceIndicators)a.append(r,x.performanceIndicators[r]);return console.log(a),e.next=12,fetch("http://localhost:5004/rusle",{method:"POST",body:a});case 12:return l=e.sent,e.next=15,l.json();case 15:(s=e.sent)&&(console.log("Data sent successfully",s),t(s),S(!1)),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),S(!1),console.error("Failed to send data",e.t0);case 23:case"end":return e.stop()}},e,null,[[0,19]])}));return function(){return e.apply(this,arguments)}}();return o.a.createElement("div",{className:a.root},o.a.createElement(Ct.a,{expanded:"panel2"===f,onChange:j("panel2")},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel2bh-content",id:"panel2bh-header"},o.a.createElement($.a,{className:a.heading},"Upload Files")),o.a.createElement(Et.a,null,o.a.createElement(xt.a,{onChange:function(e){return function(e,t){if(t&&t.length>0){var a=new FileReader;a.onload=function(){var e=Object(z.a)(W.a.mark(function e(t){var a,n,o;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(It.a)(t.target.result);case 3:a=e.sent,n=a.features.length>0?Object.keys(a.features[0].properties):[],o=n.filter(function(e){return"number"===typeof a.features[0].properties[e]}),l(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error processing shapefile",e.t0);case 12:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t){return e.apply(this,arguments)}}(),a.readAsArrayBuffer(t[0])}C(function(a){return Object(fe.a)({},a,Object(ge.a)({},e,t))})}("aoiDataFiles",e)},acceptedFiles:[".zip"],dropzoneText:"Area of Interest (AOI)",maxFileSize:5e6,filesLimit:1,getPreviewIcon:function(e,t){var a=e.file.type,n={className:t.image};if(a.startsWith("video/"))return o.a.createElement(ft.a,n);switch(a){case"application/msword":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return o.a.createElement(vt.a,n);case"application/pdf":return o.a.createElement(yt.a,n);default:return o.a.createElement(bt.a,n)}}}))),o.a.createElement(Ct.a,{expanded:"panel3"===f,onChange:j("panel3")},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel3bh-content",id:"panel3bh-header"},o.a.createElement($.a,{className:a.heading},"Dates")),o.a.createElement(Et.a,null,o.a.createElement(ue.a,{container:!0,spacing:2},o.a.createElement(ue.a,{item:!0,xs:12,sm:10},o.a.createElement(K.a,{label:"Start Date",type:"date",name:"startDate",value:x.startDate,onChange:P,className:a.dateInput,InputLabelProps:{shrink:!0}}),o.a.createElement(K.a,{label:"End Date",type:"date",name:"endDate",value:x.endDate,onChange:P,className:a.dateInput,InputLabelProps:{shrink:!0}}))))),o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement(g.a,{onClick:T,color:"#89ca92",variant:"contained"},"Submit Data"),o.a.createElement(gt.a,{className:a.backdrop,open:k},o.a.createElement(q.a,{color:"inherit"}),o.a.createElement($.a,{variant:"h6",className:a.progressText},"Ejecutando el modelo... ",O,"s")))}var Dt=Object(O.b)({palette:{primary:{main:Y.a.A200}}}),jt={root:{position:"fixed",top:74,right:10,borderRadius:4,minWidth:350,margin:0,zIndex:900},rooot:{width:"100%"},heading:{fontSize:Dt.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0},secondaryHeading:{fontSize:Dt.typography.pxToRem(15),color:Dt.palette.text.secondary},header:{backgroundColor:"#f1f1f1"},closeBtn:{position:"absolute",top:6,right:8,fontSize:22},searchField:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"2px 4px"},searchBox:{marginLeft:8,flex:1,border:"none !important"},searchBoxBtn:{padding:8},searchOptionsContainer:{padding:"5px 2px"},searchOption:{color:"rgba(0, 0, 0, 0.6)",cursor:"pointer"},searchBoxProgress:{marginRight:8},searchBoxDivider:{width:1,height:28,margin:4},resultWrapperOpen:{maxWidth:800},resultWrapperClosed:{maxWidth:350},resultContainer:{paddingTop:0,paddingBottom:0},resultTable:{boxShadow:"none"},uploadBoxInput:{display:"none"},uploadBoxBtnEdit:{width:40,height:40,lineHeight:"40px",textAlign:"center",borderRadius:"50%",fontSize:22},wrapBtn:{position:"absolute",bottom:12,left:18,padding:10,fontSize:24},addPointWrapperOpen:{maxWidth:350},addPointWrapperClose:{width:0},uploadBoxBtnAdd:{width:90,height:90,lineHeight:"90px",textAlign:"center",borderRadius:"50%",fontSize:30,backgroundColor:"rgba(0, 0, 0, 0.08)"},previewImageContainer:{display:"flex",alignItems:"center"},nameTextField:{margin:"0 20px 0 13px"},pinyinTextField:{margin:"10px 20px 10px 13px"},introTextField:{width:"100%",marginTop:5},locationImageContainer:{display:"flex",flexDirection:"column",alignItems:"center"},locationImage:{display:"block",marginTop:5,width:225,height:140,borderRadius:3,cursor:"pointer"},locationLabel:{display:"block",marginTop:6},actions:{paddingTop:10},saveBtn:{display:"inline-block",position:"relative",marginRight:10},saveBtnProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}},Pt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1,resultUnwrap:!1,addPointUnwrap:!1,optionsOpen:!1,searching:!1,submitting:!1,anchorEl:null,geometry:null,previewImage:null,previewMapUrl:null,previewCoordinate:{},loading:!0,traces:[],precipitationData:[],temperatureData:[],watsatData:[],layoutTemperature:{title:"Temperatura del Aire HC",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Temperatura (\xb0C)"}},layoutPrecipitation:{title:"Precipitaci\xf3n",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Precipitaci\xf3n (mm)"}},layoutWatsat:{title:"Modelo Watsat",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Contenido Volum\xe9trico de Agua"}},layout:{barmode:"stack",title:"Avistamientos de insectos por d\xeda",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Cantidad"}},items:[{id:1,title:"item #1"},{id:2,title:"item #2"},{id:3,title:"item #3"},{id:4,title:"item #4"},{id:5,title:"item #5"}],data:[],expanded:!1,searchOptions:[{value:"gid",label:"Gid",checked:!0},{value:"name",label:"Name",checked:!0},{value:"pinyin",label:"Pinyin",checked:!0},{value:"introduction",label:"Introduction",checked:!1}]},a.calculateSustainabilityIndex=function(){var e=1===a.state.Io?a.state.IoType:0,t=2.45*a.state.Ic+2.18*a.state.Ih+1.64*a.state.Ig+1.09*e+1*a.state.If;a.setState({sustainabilityIndex:t})},a.handleDecision=function(e){a.setState({decision:e})},a.initMaterialbox=function(){var e=document.querySelectorAll(".materialboxed");x.a.Materialbox.init(e,{onOpenStart:function(e){e.parentNode.style.overflow="visible"},onCloseEnd:function(e){e.parentNode.style.overflow="hidden"}})},a.resetPreviewImage=function(){a.setState({previewImage:null})},a.resetNewPointData=function(){a.setState({previewMapUrl:null,geometry:null,previewCoordinate:{}})},a.handleCloseClick=function(){a.setState({open:!1})},a.handleDataSubmit=function(e){a.setState({url:e}),console.log("Datos recibidos en ModelController:",e),f.emit("moveURL",a.state.url)},a.handleAddClick=function(){f.emit("getPoint"),a.handleWrapClick(),a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleWrapClick=function(){f.emit("removeTempLayer"),a.resetPreviewImage(),document.getElementById("search-box").value="",a.setState({resultUnwrap:!1})},a.handleImageChange=function(e){e.target.files[0]&&(e.target.files[0].size>1048576?f.emit("showSnackbar","error","Error: Image must be smaller than 1MB."):a.state.reader.readAsDataURL(e.target.files[0]))},a.handleDoneEdit=function(){a.resetPreviewImage(),setTimeout(a.initMaterialbox,800)},a.handleSearchOptionsClick=function(){a.setState({optionsOpen:!0})},a.handleSearchOptionsClose=function(){a.setState({optionsOpen:!1})},a.handleSearchOptionChange=function(e){var t=null,n=!1;if(a.state.searchOptions.map(function(a){return a.value===e.currentTarget.value&&(a.checked=e.currentTarget.checked,t=a),n=n||a.checked,!0}),!n)return f.emit("showSnackbar","error","Error: Please select at least one option."),void(t.checked=!0);a.setState({searchOptions:a.state.searchOptions})},a.handleSearchClick=function(){a.handleCancelClick();var e=document.getElementById("search-box").value;if(e){a.setState({searching:!0});var t={};a.state.searchOptions.map(function(e){return t[e.value]=e.checked,!0}),We({url:Ue.search.url,method:Ue.search.method,params:{keyword:e,options:JSON.stringify(t)},successCallback:function(e){a.setState({addPointWrapperClose:!1,resultUnwrap:!0,data:e.data},a.initMaterialbox)},finallyCallback:function(){a.setState({searching:!1})}})}},a.handlePreviewClick=function(e,t){f.emit("displayTempLayer",t)},a.handlePreviewMapClick=function(){f.emit("getPoint"),a.setState({addPointUnwrap:!1})},a.handleSelectChange=function(e){a.setState(Object(ge.a)({},e.target.name,Number(e.target.value)))},a.calculateSustainabilityIndex=function(){var e=a.state,t=e.Ic,n=e.Ih,o=e.Ig,i=e.Io,r=e.If,l=e.IoType,s=2.45*t+2.18*n+1.64*o+1.09*(1===i?l:0)+1*r;a.setState({sustainabilityIndex:s})},a.handleSubmitClick=function(){f.emit("removeTempPoint"),a.setState({submitting:!0});var e={name:document.getElementById("name").value,pinyin:document.getElementById("pinyin").value,introduction:document.getElementById("introduction").value,image:a.state.previewImage?a.state.previewImage:{},geometry:a.state.geometry};We({url:Ue.insert.url,method:Ue.insert.method,params:e,successCallback:function(e){f.emit("showSnackbar","success","Insert new object with Gid = '".concat(e.gid,"' successfully.")),a.handleCancelClick()},finallyCallback:function(){a.setState({searching:!1,submitting:!1})}})},a.handleCancelClick=function(){f.emit("removeTempPoint"),document.getElementById("name").value="",document.getElementById("pinyin").value="",document.getElementById("introduction").value="",a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleRowUpdate=function(e,t){return new Promise(function(n){t.gid!==e.gid&&f.emit("showSnackbar","error","Column 'Gid' is readonly.");var o={gid:t.gid};a.state.previewImage?e.image=a.state.previewImage:e.image={},Object.keys(e).map(function(a){return"geometry"!==a&&e[a]!==t[a]&&(o[a]=e[a]),!0}),Ne(o)?f.emit("showSnackbar","default","Nothing to update."):We({url:Ue.update.url,method:Ue.update.method,params:o,successCallback:function(n){var o="Update ".concat(n.count," ").concat(n.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",o);var i=a.state.data;i[i.indexOf(t)]=e,a.setState({data:i})},finallyCallback:function(){n(),a.handleDoneEdit()}})})},a.handleRowDelete=function(e){return new Promise(function(t){We({url:Ue.delete.url,method:Ue.delete.method,params:{gid:e.gid},successCallback:function(t){var n="Delete ".concat(t.count," ").concat(t.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",n);var o=Object(Re.a)(a.state.data);o.splice(o.indexOf(e),1),a.setState(Object(fe.a)({},a.state,{data:o}))},finallyCallback:function(){t(),f.emit("removeTempLayer"),a.handleDoneEdit()}})})},a.moveURL=function(){var e=a.state.url;a.setState({movedURL:e}),console.log(a.state.movedURL)},a.processTemperatureData=function(e){var t={type:"scatter",mode:"lines",x:e.map(function(e){return new Date(e.sampling_date)}),y:e.map(function(e){return e.measurement_value}),name:"Temperatura del Aire HC"};a.setState({temperatureData:[t],loading:!1})},a.processPrecipitationData=function(e){var t={type:"scatter",mode:"lines",x:e.map(function(e){return new Date(e.sampling_date)}),y:e.map(function(e){return e.measurement_value}),name:"Precipitaci\xf3n"};a.setState({precipitationData:[t],loading:!1})},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("anchorEl"),a=new FileReader;a.onload=function(t){var a=new Image;a.src=t.target.result;var n={longitude:a.height>a.width,src:t.target.result};e.setState({previewImage:n})},this.setState({reader:a,anchorEl:t}),this.openRusleControllerListener=f.addListener("openRusleController",function(){e.setState({open:!0})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})}),this.updatePointListener=f.addListener("setPoint",function(t,a,n){var o=Object(Ae.a)(t.geometry.coordinates,2),i=o[0],r=o[1],l="https://api.mapbox.com/styles/v1/".concat(a,"/static/pin-s+f00(").concat(i,",").concat(r,")/").concat(i,",").concat(r,",").concat(n,",0,1/250x155@2x?access_token=").concat(_e);e.setState({addPointUnwrap:!0,previewMapUrl:l,geometry:t,previewCoordinate:{lng:parseFloat(i).toFixed(3),lat:parseFloat(r).toFixed(3)}})}),this.moveURListener=f.addListener("moveURL",function(){e.moveURL()})}},{key:"setIc",value:function(e){this.setState({Ic:e})}},{key:"setIh",value:function(e){this.setState({Ih:e})}},{key:"setIg",value:function(e){this.setState({Ig:e})}},{key:"setIo",value:function(e){this.setState({Io:e})}},{key:"setIoType",value:function(e){this.setState({IoType:e})}},{key:"setIf",value:function(e){this.setState({If:e})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openRusleControllerListener),f.removeListener(this.closeAllControllerListener),f.removeListener(this.addPointListener),f.removeListener(this.updatePointListener),f.removeListener(this.moveURListener),document.querySelectorAll(".materialboxed").map(function(e){return e.destory()})}},{key:"render",value:function(){return o.a.createElement(D.a,{theme:Dt},o.a.createElement(Z.a,{direction:"left",in:this.state.open},o.a.createElement(ce.a,{style:jt.root},o.a.createElement(de.a,{style:jt.header},o.a.createElement($.a,{variant:"h5",className:jt.title},"RUSLE Modelling"),"\xa0\xa0",o.a.createElement(Ot,{onSubmit:this.handleDataSubmit}),o.a.createElement(I.a,{style:jt.closeBtn,"aria-label":"Close",onClick:this.handleCloseClick},o.a.createElement(L.a,{fontSize:"inherit"},"chevron_right"))))))}}]),t}(o.a.Component),Tt=a(381),Bt=a(453),At=a(454),Rt=a(460),Mt=Object(ht.a)(function(e){return{root:{width:"100%","& .MuiDropzoneArea-root":{minHeight:"100px",maxHeight:"200px"}},fileDetails:{marginTop:e.spacing(1)},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0,fontWeight:"bold"},secondaryHeading:{fontSize:e.typography.pxToRem(15),color:e.palette.text.secondary},checkBoxContainer:{display:"flex",flexDirection:"row",justifyContent:"center",flexWrap:"wrap"},formControl:{margin:e.spacing(1),minWidth:120,width:"100%"},inputLabel:{marginBottom:e.spacing(1)},dateInput:{width:"100%",marginTop:e.spacing(2),marginBottom:e.spacing(2)},foormControl:{margin:e.spacing(3)},dropzone:{minHeight:"191px"},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},progressText:{marginLeft:e.spacing(2)}}});function _t(e){var t=e.onSubmit,a=Mt(),i=Object(n.useState)([]),r=Object(Ae.a)(i,2),l=r[0],s=r[1],c=Object(n.useState)(""),d=Object(Ae.a)(c,2),u=d[0],m=d[1],p=Object(n.useState)("rf"),h=Object(Ae.a)(p,2),f=h[0],v=h[1],y=Object(n.useState)(!1),b=Object(Ae.a)(y,2),x=b[0],C=b[1],E=Object(n.useState)({rf:!1,svm:!1,knn:!1,soilDataFiles:[],aoiDataFiles:[],startDate:"2024-04-14",endDate:"2024-05-14",satelliteData:{sentinel1:!1,sentinel2:!1,landsat:!1},indexes:{vegetationIndexes:!1,brightnessIndexes:!1,moistureIndexes:!1},modelFeatures:{numberOfTrees:500,seed:1e-4,bagFraction:0},performanceIndicators:{rsquare:!1,rmse:!1,mse:!1,mae:!1,rpiq:!1}}),w=Object(Ae.a)(E,2),k=w[0],S=w[1],I=Object(n.useState)(!1),L=Object(Ae.a)(I,2),O=L[0],D=L[1],j=Object(n.useState)(0),P=Object(Ae.a)(j,2),T=P[0],B=P[1];Object(n.useEffect)(function(){var e;return O?e=setInterval(function(){B(function(e){return e+1})},1e3):clearInterval(e),function(){return clearInterval(e)}},[O]);var A=function(e){return function(t,a){C(!!a&&e)}},R=function(e){var t=e.target,a=t.name,n=t.value,o=t.checked,i=t.type;S(function(e){return Object(fe.a)({},e,Object(ge.a)({},a,"checkbox"===i||"radio"===i?o:n))}),"options"===a&&v(n)},M=function(e,t){if(t&&t.length>0){var a=new FileReader;a.onload=function(){var e=Object(z.a)(W.a.mark(function e(t){var a,n,o;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(It.a)(t.target.result);case 3:a=e.sent,n=a.features.length>0?Object.keys(a.features[0].properties):[],o=n.filter(function(e){return"number"===typeof a.features[0].properties[e]}),s(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error processing shapefile",e.t0);case 12:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t){return e.apply(this,arguments)}}(),a.readAsArrayBuffer(t[0])}S(function(a){return Object(fe.a)({},a,Object(ge.a)({},e,t))})},_=function(e,t){var a=e.file.type,n={className:t.image};if(a.startsWith("video/"))return o.a.createElement(ft.a,n);switch(a){case"application/msword":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return o.a.createElement(vt.a,n);case"application/pdf":return o.a.createElement(yt.a,n);default:return o.a.createElement(bt.a,n)}},F=function(){var e=Object(z.a)(W.a.mark(function e(){var a,n,o,i,r,l,s;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n in e.prev=0,D(!0),B(0),(a=new FormData).append("soilDataFiles",k.soilDataFiles[0]),a.append("aoiDataFiles",k.aoiDataFiles[0]),k.satelliteData)a.append(n,k.satelliteData[n]);for(o in k.indexes)a.append(o,k.indexes[o]);for(i in k.modelFeatures)a.append(i,k.modelFeatures[i]);for(r in k.performanceIndicators)a.append(r,k.performanceIndicators[r]);return console.log(a),e.next=13,fetch("http://localhost:5004/soil_organic_prediction",{method:"POST",body:a});case 13:return l=e.sent,e.next=16,l.json();case 16:(s=e.sent)&&(console.log("Data sent successfully",s),t(s),D(!1)),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),D(!1),console.error("Failed to send data",e.t0);case 24:case"end":return e.stop()}},e,null,[[0,20]])}));return function(){return e.apply(this,arguments)}}();return o.a.createElement("div",{className:a.root},o.a.createElement(Ct.a,{expanded:"panel1"===x,onChange:A("panel1")},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel1bh-content",id:"panel1bh-header"},o.a.createElement($.a,{className:a.heading},"Machine learning algorithm")),o.a.createElement(Et.a,null,o.a.createElement(Tt.a,{className:a.checkBoxContainer},o.a.createElement(Bt.a,{row:!0,name:"options",value:f,onChange:R},o.a.createElement(At.a,{value:"rf",control:o.a.createElement(Rt.a,null),label:"RF"}),o.a.createElement(At.a,{value:"svm",control:o.a.createElement(Rt.a,null),label:"SVM"}),o.a.createElement(At.a,{value:"knn",control:o.a.createElement(Rt.a,null),label:"KNN"}))))),o.a.createElement(Ct.a,{expanded:"panel2"===x,onChange:A("panel2")},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel2bh-content",id:"panel2bh-header"},o.a.createElement($.a,{className:a.heading},"Upload Files")),o.a.createElement(Et.a,null,o.a.createElement(xt.a,{onChange:function(e){return M("soilDataFiles",e)},acceptedFiles:[".zip"],dropzoneText:"Soil Samples",maxFileSize:5e6,filesLimit:1,getPreviewIcon:_}),o.a.createElement(xt.a,{onChange:function(e){return M("aoiDataFiles",e)},acceptedFiles:[".zip"],dropzoneText:"Area of Interest (AOI)",maxFileSize:5e6,filesLimit:1,getPreviewIcon:_}))),l.length>0?o.a.createElement(o.a.Fragment,null,o.a.createElement(Ct.a,{expanded:"panel6"===x,onChange:A("panel6")},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel4bh-content",id:"panel4bh-header"},o.a.createElement($.a,{className:a.heading},"Variable to Estimate")),o.a.createElement(Et.a,null,o.a.createElement(ye.a,{fullWidth:!0},o.a.createElement(be.a,{id:"numeric-column-selector-label"},"Select Value to Estimate"),o.a.createElement(xe.a,{labelId:"numeric-column-selector-label",id:"numeric-column-selector",value:u,label:"Select Numeric Column",onChange:function(e){m(e.target.value)}},l.map(function(e,t){return o.a.createElement(we.a,{key:t,value:e},e)})))))):o.a.createElement(o.a.Fragment,null),o.a.createElement(Ct.a,{expanded:"panel3"===x,onChange:A("panel3")},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel3bh-content",id:"panel3bh-header"},o.a.createElement($.a,{className:a.heading},"Spectral Information Data")),o.a.createElement(Et.a,null,o.a.createElement(ue.a,{container:!0,spacing:2},o.a.createElement(ue.a,{item:!0,xs:12,sm:10},o.a.createElement(K.a,{label:"Start Date",type:"date",name:"startDate",value:k.startDate,onChange:R,className:a.dateInput,InputLabelProps:{shrink:!0}}),o.a.createElement(K.a,{label:"End Date",type:"date",name:"endDate",value:k.endDate,onChange:R,className:a.dateInput,InputLabelProps:{shrink:!0}}))),o.a.createElement(ue.a,{container:!0,spacing:2},o.a.createElement(ue.a,{item:!0,xs:12,sm:6},o.a.createElement(ye.a,{component:"fieldset",className:a.formControl},o.a.createElement($.a,{variant:"subtitle1"},"Satellite Data:"),o.a.createElement(Tt.a,null,o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"sentinel1",checked:k.satelliteData.sentinel1,onChange:R}),label:"Sentinel-1"}),o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"sentinel2",checked:k.satelliteData.sentinel2,onChange:R}),label:"Sentinel-2"}),o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"landsat",checked:k.satelliteData.landsat,onChange:R}),label:"Landsat"})))),o.a.createElement(ue.a,{item:!0,xs:12,sm:6},o.a.createElement(ye.a,{component:"fieldset",className:a.formControl},o.a.createElement($.a,{variant:"subtitle1"},"Indexes:"),o.a.createElement(Tt.a,null,o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"vegetationIndexes",checked:k.indexes.vegetationIndexes,onChange:R}),label:"Vegetation indexes"}),o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"brightnessIndexes",checked:k.indexes.brightnessIndexes,onChange:R}),label:"Brightness indexes"}),o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"moistureIndexes",checked:k.indexes.moistureIndexes,onChange:R}),label:"Moisture indexes"}))))))),o.a.createElement(Ct.a,{expanded:"panel4"===x,onChange:A("panel4")},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel4bh-content",id:"panel4bh-header"},o.a.createElement($.a,{className:a.heading},"Model features")),o.a.createElement(Et.a,null,function(){switch(f){case"rf":return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,o.a.createElement($.a,{className:a.inputLabel},"Number of trees"),o.a.createElement(K.a,{className:a.formControl,variant:"outlined",name:"numberOfTrees",value:k.modelFeatures.numberOfTrees,onChange:R,type:"number"})),"\xa0\xa0",o.a.createElement("div",null,o.a.createElement($.a,{className:a.inputLabel},"Seed"),o.a.createElement(K.a,{className:a.formControl,variant:"outlined",name:"seed",value:k.modelFeatures.seed,onChange:R,type:"number",inputProps:{step:"0.0001"}})),"\xa0\xa0",o.a.createElement("div",null,o.a.createElement($.a,{className:a.inputLabel},"Bag fraction"),o.a.createElement(K.a,{className:a.formControl,variant:"outlined",name:"bagFraction",value:k.modelFeatures.bagFraction,onChange:R,type:"number"})));case"svm":case"knn":return o.a.createElement(o.a.Fragment,null);default:return null}}())),o.a.createElement(Ct.a,{expanded:"panel5"===x,onChange:A("panel5")},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel4bh-content",id:"panel4bh-header"},o.a.createElement($.a,{className:a.heading},"Model Performance Indicators")),o.a.createElement(Et.a,null,o.a.createElement(Tt.a,{className:a.checkBoxContainer},o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"rsquare",checked:k.performanceIndicators.rsquare,onChange:R}),label:"R SQUARE"}),o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"rmse",checked:k.performanceIndicators.rmse,onChange:R}),label:"RMSE"}),o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"mse",checked:k.performanceIndicators.mse,onChange:R}),label:"MSE"}),o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"mae",checked:k.performanceIndicators.mae,onChange:R}),label:"MAE"}),o.a.createElement(At.a,{control:o.a.createElement(G.a,{name:"rpiq",checked:k.performanceIndicators.rpiq,onChange:R}),label:"RPIQ"})))),o.a.createElement("div",null),o.a.createElement("div",null),o.a.createElement(g.a,{onClick:F,color:"#89ca92",variant:"contained"},"Submit Data"),o.a.createElement(gt.a,{className:a.backdrop,open:O},o.a.createElement(q.a,{color:"inherit"}),o.a.createElement($.a,{variant:"h6",className:a.progressText},"Ejecutando el modelo... ",T,"s")))}var Ft=Object(O.b)({palette:{primary:{main:Y.a.A200}}}),Ut={root:{position:"fixed",top:74,right:10,borderRadius:4,minWidth:350,margin:0,zIndex:900},rooot:{width:"100%"},heading:{fontSize:Ft.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0},secondaryHeading:{fontSize:Ft.typography.pxToRem(15),color:Ft.palette.text.secondary},header:{backgroundColor:"#f1f1f1"},closeBtn:{position:"absolute",top:6,right:8,fontSize:22},searchField:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"2px 4px"},searchBox:{marginLeft:8,flex:1,border:"none !important"},searchBoxBtn:{padding:8},searchOptionsContainer:{padding:"5px 2px"},searchOption:{color:"rgba(0, 0, 0, 0.6)",cursor:"pointer"},searchBoxProgress:{marginRight:8},searchBoxDivider:{width:1,height:28,margin:4},resultWrapperOpen:{maxWidth:800},resultWrapperClosed:{maxWidth:350},resultContainer:{paddingTop:0,paddingBottom:0},resultTable:{boxShadow:"none"},uploadBoxInput:{display:"none"},uploadBoxBtnEdit:{width:40,height:40,lineHeight:"40px",textAlign:"center",borderRadius:"50%",fontSize:22},wrapBtn:{position:"absolute",bottom:12,left:18,padding:10,fontSize:24},addPointWrapperOpen:{maxWidth:350},addPointWrapperClose:{width:0},uploadBoxBtnAdd:{width:90,height:90,lineHeight:"90px",textAlign:"center",borderRadius:"50%",fontSize:30,backgroundColor:"rgba(0, 0, 0, 0.08)"},previewImageContainer:{display:"flex",alignItems:"center"},nameTextField:{margin:"0 20px 0 13px"},pinyinTextField:{margin:"10px 20px 10px 13px"},introTextField:{width:"100%",marginTop:5},locationImageContainer:{display:"flex",flexDirection:"column",alignItems:"center"},locationImage:{display:"block",marginTop:5,width:225,height:140,borderRadius:3,cursor:"pointer"},locationLabel:{display:"block",marginTop:6},actions:{paddingTop:10},saveBtn:{display:"inline-block",position:"relative",marginRight:10},saveBtnProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}},Nt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1,resultUnwrap:!1,addPointUnwrap:!1,optionsOpen:!1,searching:!1,submitting:!1,anchorEl:null,geometry:null,previewImage:null,previewMapUrl:null,previewCoordinate:{},loading:!0,traces:[],precipitationData:[],temperatureData:[],watsatData:[],layoutTemperature:{title:"Temperatura del Aire HC",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Temperatura (\xb0C)"}},layoutPrecipitation:{title:"Precipitaci\xf3n",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Precipitaci\xf3n (mm)"}},layoutWatsat:{title:"Modelo Watsat",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Contenido Volum\xe9trico de Agua"}},layout:{barmode:"stack",title:"Avistamientos de insectos por d\xeda",xaxis:{title:"Fecha",type:"date"},yaxis:{title:"Cantidad"}},items:[{id:1,title:"item #1"},{id:2,title:"item #2"},{id:3,title:"item #3"},{id:4,title:"item #4"},{id:5,title:"item #5"}],data:[],expanded:!1,searchOptions:[{value:"gid",label:"Gid",checked:!0},{value:"name",label:"Name",checked:!0},{value:"pinyin",label:"Pinyin",checked:!0},{value:"introduction",label:"Introduction",checked:!1}]},a.calculateSustainabilityIndex=function(){var e=1===a.state.Io?a.state.IoType:0,t=2.45*a.state.Ic+2.18*a.state.Ih+1.64*a.state.Ig+1.09*e+1*a.state.If;a.setState({sustainabilityIndex:t})},a.handleDecision=function(e){a.setState({decision:e})},a.initMaterialbox=function(){var e=document.querySelectorAll(".materialboxed");x.a.Materialbox.init(e,{onOpenStart:function(e){e.parentNode.style.overflow="visible"},onCloseEnd:function(e){e.parentNode.style.overflow="hidden"}})},a.resetPreviewImage=function(){a.setState({previewImage:null})},a.resetNewPointData=function(){a.setState({previewMapUrl:null,geometry:null,previewCoordinate:{}})},a.handleCloseClick=function(){a.setState({open:!1})},a.handleDataSubmit=function(e){a.setState({url:e}),console.log("Datos recibidos en ModelController:",e),f.emit("moveURL",a.state.url)},a.handleAddClick=function(){f.emit("getPoint"),a.handleWrapClick(),a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleWrapClick=function(){f.emit("removeTempLayer"),a.resetPreviewImage(),document.getElementById("search-box").value="",a.setState({resultUnwrap:!1})},a.handleImageChange=function(e){e.target.files[0]&&(e.target.files[0].size>1048576?f.emit("showSnackbar","error","Error: Image must be smaller than 1MB."):a.state.reader.readAsDataURL(e.target.files[0]))},a.handleDoneEdit=function(){a.resetPreviewImage(),setTimeout(a.initMaterialbox,800)},a.handleSearchOptionsClick=function(){a.setState({optionsOpen:!0})},a.handleSearchOptionsClose=function(){a.setState({optionsOpen:!1})},a.handleSearchOptionChange=function(e){var t=null,n=!1;if(a.state.searchOptions.map(function(a){return a.value===e.currentTarget.value&&(a.checked=e.currentTarget.checked,t=a),n=n||a.checked,!0}),!n)return f.emit("showSnackbar","error","Error: Please select at least one option."),void(t.checked=!0);a.setState({searchOptions:a.state.searchOptions})},a.handleSearchClick=function(){a.handleCancelClick();var e=document.getElementById("search-box").value;if(e){a.setState({searching:!0});var t={};a.state.searchOptions.map(function(e){return t[e.value]=e.checked,!0}),We({url:Ue.search.url,method:Ue.search.method,params:{keyword:e,options:JSON.stringify(t)},successCallback:function(e){a.setState({addPointWrapperClose:!1,resultUnwrap:!0,data:e.data},a.initMaterialbox)},finallyCallback:function(){a.setState({searching:!1})}})}},a.handlePreviewClick=function(e,t){f.emit("displayTempLayer",t)},a.handlePreviewMapClick=function(){f.emit("getPoint"),a.setState({addPointUnwrap:!1})},a.handleSelectChange=function(e){a.setState(Object(ge.a)({},e.target.name,Number(e.target.value)))},a.calculateSustainabilityIndex=function(){var e=a.state,t=e.Ic,n=e.Ih,o=e.Ig,i=e.Io,r=e.If,l=e.IoType,s=2.45*t+2.18*n+1.64*o+1.09*(1===i?l:0)+1*r;a.setState({sustainabilityIndex:s})},a.handleSubmitClick=function(){f.emit("removeTempPoint"),a.setState({submitting:!0});var e={name:document.getElementById("name").value,pinyin:document.getElementById("pinyin").value,introduction:document.getElementById("introduction").value,image:a.state.previewImage?a.state.previewImage:{},geometry:a.state.geometry};We({url:Ue.insert.url,method:Ue.insert.method,params:e,successCallback:function(e){f.emit("showSnackbar","success","Insert new object with Gid = '".concat(e.gid,"' successfully.")),a.handleCancelClick()},finallyCallback:function(){a.setState({searching:!1,submitting:!1})}})},a.handleCancelClick=function(){f.emit("removeTempPoint"),document.getElementById("name").value="",document.getElementById("pinyin").value="",document.getElementById("introduction").value="",a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.handleRowUpdate=function(e,t){return new Promise(function(n){t.gid!==e.gid&&f.emit("showSnackbar","error","Column 'Gid' is readonly.");var o={gid:t.gid};a.state.previewImage?e.image=a.state.previewImage:e.image={},Object.keys(e).map(function(a){return"geometry"!==a&&e[a]!==t[a]&&(o[a]=e[a]),!0}),Ne(o)?f.emit("showSnackbar","default","Nothing to update."):We({url:Ue.update.url,method:Ue.update.method,params:o,successCallback:function(n){var o="Update ".concat(n.count," ").concat(n.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",o);var i=a.state.data;i[i.indexOf(t)]=e,a.setState({data:i})},finallyCallback:function(){n(),a.handleDoneEdit()}})})},a.handleRowDelete=function(e){return new Promise(function(t){We({url:Ue.delete.url,method:Ue.delete.method,params:{gid:e.gid},successCallback:function(t){var n="Delete ".concat(t.count," ").concat(t.count>1?"objects":"object"," successfully.");f.emit("showSnackbar","success",n);var o=Object(Re.a)(a.state.data);o.splice(o.indexOf(e),1),a.setState(Object(fe.a)({},a.state,{data:o}))},finallyCallback:function(){t(),f.emit("removeTempLayer"),a.handleDoneEdit()}})})},a.moveURL=function(){var e=a.state.url;a.setState({movedURL:e}),console.log(a.state.movedURL)},a.processTemperatureData=function(e){var t={type:"scatter",mode:"lines",x:e.map(function(e){return new Date(e.sampling_date)}),y:e.map(function(e){return e.measurement_value}),name:"Temperatura del Aire HC"};a.setState({temperatureData:[t],loading:!1})},a.processPrecipitationData=function(e){var t={type:"scatter",mode:"lines",x:e.map(function(e){return new Date(e.sampling_date)}),y:e.map(function(e){return e.measurement_value}),name:"Precipitaci\xf3n"};a.setState({precipitationData:[t],loading:!1})},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("anchorEl"),a=new FileReader;a.onload=function(t){var a=new Image;a.src=t.target.result;var n={longitude:a.height>a.width,src:t.target.result};e.setState({previewImage:n})},this.setState({reader:a,anchorEl:t}),this.openSocControllerListener=f.addListener("openSocController",function(){e.setState({open:!0})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})}),this.updatePointListener=f.addListener("setPoint",function(t,a,n){var o=Object(Ae.a)(t.geometry.coordinates,2),i=o[0],r=o[1],l="https://api.mapbox.com/styles/v1/".concat(a,"/static/pin-s+f00(").concat(i,",").concat(r,")/").concat(i,",").concat(r,",").concat(n,",0,1/250x155@2x?access_token=").concat(_e);e.setState({addPointUnwrap:!0,previewMapUrl:l,geometry:t,previewCoordinate:{lng:parseFloat(i).toFixed(3),lat:parseFloat(r).toFixed(3)}})}),this.moveURListener=f.addListener("moveURL",function(){e.moveURL()})}},{key:"setIc",value:function(e){this.setState({Ic:e})}},{key:"setIh",value:function(e){this.setState({Ih:e})}},{key:"setIg",value:function(e){this.setState({Ig:e})}},{key:"setIo",value:function(e){this.setState({Io:e})}},{key:"setIoType",value:function(e){this.setState({IoType:e})}},{key:"setIf",value:function(e){this.setState({If:e})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openSocControllerListener),f.removeListener(this.closeAllControllerListener),f.removeListener(this.addPointListener),f.removeListener(this.updatePointListener),f.removeListener(this.moveURListener),document.querySelectorAll(".materialboxed").map(function(e){return e.destory()})}},{key:"render",value:function(){return o.a.createElement(D.a,{theme:Ft},o.a.createElement(Z.a,{direction:"left",in:this.state.open},o.a.createElement(ce.a,{style:Ut.root},o.a.createElement(de.a,{style:Ut.header},o.a.createElement($.a,{variant:"h5",className:Ut.title},"Digital Soil Mapping"),"\xa0\xa0",o.a.createElement(_t,{onSubmit:this.handleDataSubmit}),o.a.createElement(I.a,{style:Ut.closeBtn,"aria-label":"Close",onClick:this.handleCloseClick},o.a.createElement(L.a,{fontSize:"inherit"},"chevron_right"))))))}}]),t}(o.a.Component),Wt=Object(ht.a)(function(e){return{root:{width:"100%"},formControl:{margin:e.spacing(1),minWidth:120,width:"100%"},dateInput:{width:"100%",marginTop:e.spacing(2),marginBottom:e.spacing(2)},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},progressText:{marginLeft:e.spacing(2)}}});function zt(e){var t=e.onSubmit,a=Wt(),i=Object(n.useState)(!1),r=Object(Ae.a)(i,2),l=r[0],s=r[1],c=Object(n.useState)({startDate:"2024-04-14",endDate:"2024-05-14",indexType:"NDVI",aoiDataFiles:[]}),d=Object(Ae.a)(c,2),u=d[0],m=d[1],p=Object(n.useState)(!1),h=Object(Ae.a)(p,2),f=h[0],v=h[1],y=Object(n.useState)(0),b=Object(Ae.a)(y,2),x=b[0],C=b[1];Object(n.useEffect)(function(){var e;return f?e=setInterval(function(){C(function(e){return e+1})},1e3):clearInterval(e),function(){return clearInterval(e)}},[f]);var E,w=function(e){var t=e.target,a=t.name,n=t.value;m(function(e){return Object(fe.a)({},e,Object(ge.a)({},a,n))})},k=function(){var e=Object(z.a)(W.a.mark(function e(){var a,n,o;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v(!0),C(0),(a=new FormData).append("aoiDataFiles",u.aoiDataFiles[0]),a.append("indexType",u.indexType),a.append("startDate",u.startDate),a.append("endDate",u.endDate),e.next=10,fetch("http://localhost:5004/vegetation_index_change_inspector",{method:"POST",body:a});case 10:return n=e.sent,e.next=13,n.json();case 13:if(o=e.sent,console.log(o),!o){e.next=20;break}return console.log("Data sent successfully",o),t(o),v(!1),e.abrupt("return",!0);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),console.error("Failed to send data",e.t0);case 25:case"end":return e.stop()}},e,null,[[0,22]])}));return function(){return e.apply(this,arguments)}}();return o.a.createElement("div",{className:a.root},o.a.createElement(Ct.a,{expanded:"panel1"===l,onChange:(E="panel1",function(e,t){s(!!t&&E)})},o.a.createElement(wt.a,{expandIcon:o.a.createElement(St.a,null),"aria-controls":"panel1bh-content",id:"panel1bh-header"},o.a.createElement($.a,{className:a.heading},"Choose a veg index")),o.a.createElement(Et.a,null,o.a.createElement(xt.a,{onChange:function(e){return function(e,t){if(t&&t.length>0){var a=new FileReader;a.onload=function(){var e=Object(z.a)(W.a.mark(function e(t){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.readAsArrayBuffer(t[0])}m(function(a){return Object(fe.a)({},a,Object(ge.a)({},e,t))})}("aoiDataFiles",e)},acceptedFiles:[".zip"],dropzoneText:"Area of Interest (AOI)",maxFileSize:5e6,filesLimit:1,getPreviewIcon:function(e,t){var a=e.file.type,n={className:t.image};if(a.startsWith("video/"))return o.a.createElement(ft.a,n);switch(a){case"application/msword":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return o.a.createElement(vt.a,n);case"application/pdf":return o.a.createElement(yt.a,n);default:return o.a.createElement(bt.a,n)}}})),o.a.createElement(Et.a,null,o.a.createElement(ye.a,{className:a.formControl},o.a.createElement(K.a,{label:"Start Date",type:"date",name:"startDate",value:u.startDate,onChange:w,className:a.dateInput,InputLabelProps:{shrink:!0}}),o.a.createElement(K.a,{label:"End Date",type:"date",name:"endDate",value:u.endDate,onChange:w,className:a.dateInput,InputLabelProps:{shrink:!0}}),o.a.createElement(be.a,{id:"index-type-label"},"Index Type"),o.a.createElement(xe.a,{labelId:"index-type-label",id:"index-type-select",value:u.indexType,onChange:w,name:"indexType"},o.a.createElement(we.a,{value:"NDVI"},"NDVI"),o.a.createElement(we.a,{value:"EVI"},"EVI"),o.a.createElement(we.a,{value:"SAVI"},"SAVI"))))),o.a.createElement(g.a,{onClick:k,color:"primary",variant:"contained"},"Submit Data"),o.a.createElement(gt.a,{className:a.backdrop,open:f},o.a.createElement(q.a,{color:"inherit"}),o.a.createElement($.a,{variant:"h6",className:a.progressText},"Ejecutando el modelo... ",x,"s")))}var Ht=Object(O.b)({palette:{primary:{main:Y.a.A200}}}),Vt={root:{position:"fixed",top:74,right:10,borderRadius:4,minWidth:350,margin:0,zIndex:900},rooot:{width:"100%"},heading:{fontSize:Ht.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0},secondaryHeading:{fontSize:Ht.typography.pxToRem(15),color:Ht.palette.text.secondary},header:{backgroundColor:"#f1f1f1"},closeBtn:{position:"absolute",top:6,right:8,fontSize:22},searchField:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"2px 4px"},searchBox:{marginLeft:8,flex:1,border:"none !important"},searchBoxBtn:{padding:8},searchOptionsContainer:{padding:"5px 2px"},searchOption:{color:"rgba(0, 0, 0, 0.6)",cursor:"pointer"},searchBoxProgress:{marginRight:8},searchBoxDivider:{width:1,height:28,margin:4},resultWrapperOpen:{maxWidth:800},resultWrapperClosed:{maxWidth:350},resultContainer:{paddingTop:0,paddingBottom:0},resultTable:{boxShadow:"none"},uploadBoxInput:{display:"none"},uploadBoxBtnEdit:{width:40,height:40,lineHeight:"40px",textAlign:"center",borderRadius:"50%",fontSize:22},wrapBtn:{position:"absolute",bottom:12,left:18,padding:10,fontSize:24},addPointWrapperOpen:{maxWidth:350},addPointWrapperClose:{width:0},uploadBoxBtnAdd:{width:90,height:90,lineHeight:"90px",textAlign:"center",borderRadius:"50%",fontSize:30,backgroundColor:"rgba(0, 0, 0, 0.08)"},previewImageContainer:{display:"flex",alignItems:"center"},nameTextField:{margin:"0 20px 0 13px"},pinyinTextField:{margin:"10px 20px 10px 13px"},introTextField:{width:"100%",marginTop:5},locationImageContainer:{display:"flex",flexDirection:"column",alignItems:"center"},locationImage:{display:"block",marginTop:5,width:225,height:140,borderRadius:3,cursor:"pointer"},locationLabel:{display:"block",marginTop:6},actions:{paddingTop:10},saveBtn:{display:"inline-block",position:"relative",marginRight:10},saveBtnProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}},Gt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1},a.handleCloseClick=function(){a.setState({open:!1})},a.handleDataSubmit=function(e){a.setState({url:e}),console.log("Datos recibidos en BandController:",e),f.emit("moveURL",a.state.url)},a.handleWrapClick=function(){f.emit("removeTempLayer"),a.resetPreviewImage(),document.getElementById("search-box").value="",a.setState({resultUnwrap:!1})},a.handleSearchOptionChange=function(e){var t=null,n=!1;if(a.state.searchOptions.map(function(a){return a.value===e.currentTarget.value&&(a.checked=e.currentTarget.checked,t=a),n=n||a.checked,!0}),!n)return f.emit("showSnackbar","error","Error: Please select at least one option."),void(t.checked=!0);a.setState({searchOptions:a.state.searchOptions})},a.handleSearchClick=function(){a.handleCancelClick();var e=document.getElementById("search-box").value;if(e){a.setState({searching:!0});var t={};a.state.searchOptions.map(function(e){return t[e.value]=e.checked,!0}),We({url:Ue.search.url,method:Ue.search.method,params:{keyword:e,options:JSON.stringify(t)},successCallback:function(e){a.setState({addPointWrapperClose:!1,resultUnwrap:!0,data:e.data},a.initMaterialbox)},finallyCallback:function(){a.setState({searching:!1})}})}},a.handlePreviewClick=function(e,t){f.emit("displayTempLayer",t)},a.handlePreviewMapClick=function(){f.emit("getPoint"),a.setState({addPointUnwrap:!1})},a.handleSelectChange=function(e){a.setState(Object(ge.a)({},e.target.name,Number(e.target.value)))},a.handleSubmitClick=function(){f.emit("removeTempPoint"),a.setState({submitting:!0});var e={name:document.getElementById("name").value,pinyin:document.getElementById("pinyin").value,introduction:document.getElementById("introduction").value,image:a.state.previewImage?a.state.previewImage:{},geometry:a.state.geometry};We({url:Ue.insert.url,method:Ue.insert.method,params:e,successCallback:function(e){f.emit("showSnackbar","success","Insert new object with Gid = '".concat(e.gid,"' successfully.")),a.handleCancelClick()},finallyCallback:function(){a.setState({searching:!1,submitting:!1})}})},a.handleCancelClick=function(){f.emit("removeTempPoint"),document.getElementById("name").value="",document.getElementById("pinyin").value="",document.getElementById("introduction").value="",a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.moveURL=function(){var e=a.state.url;a.setState({movedURL:e}),console.log(a.state.movedURL)},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("anchorEl"),a=new FileReader;a.onload=function(t){var a=new Image;a.src=t.target.result;var n={longitude:a.height>a.width,src:t.target.result};e.setState({previewImage:n})},this.setState({reader:a,anchorEl:t}),this.openVegInspectorControllerListener=f.addListener("openVegInspectorController",function(){e.setState({open:!0})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})}),this.updatePointListener=f.addListener("setPoint",function(t,a,n){var o=Object(Ae.a)(t.geometry.coordinates,2),i=o[0],r=o[1],l="https://api.mapbox.com/styles/v1/".concat(a,"/static/pin-s+f00(").concat(i,",").concat(r,")/").concat(i,",").concat(r,",").concat(n,",0,1/250x155@2x?access_token=").concat(_e);e.setState({addPointUnwrap:!0,previewMapUrl:l,geometry:t,previewCoordinate:{lng:parseFloat(i).toFixed(3),lat:parseFloat(r).toFixed(3)}})}),this.moveURListener=f.addListener("moveURL",function(){e.moveURL()})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openBandControllerListener),f.removeListener(this.closeAllControllerListener),f.removeListener(this.addPointListener),f.removeListener(this.updatePointListener),f.removeListener(this.moveURListener),document.querySelectorAll(".materialboxed").map(function(e){return e.destory()})}},{key:"render",value:function(){return o.a.createElement(D.a,{theme:Ht},o.a.createElement(Z.a,{direction:"left",in:this.state.open},o.a.createElement(ce.a,{style:Vt.root},o.a.createElement(de.a,{style:Vt.header},o.a.createElement($.a,{variant:"h5",className:Vt.title},"Vegetation Index Change Inspector"),"\xa0\xa0",o.a.createElement(zt,{onSubmit:this.handleDataSubmit}),o.a.createElement(I.a,{style:Vt.closeBtn,"aria-label":"Close",onClick:this.handleCloseClick},o.a.createElement(L.a,{fontSize:"inherit"},"chevron_right"))))))}}]),t}(o.a.Component),qt=a(458),Jt=a(472),Zt=a(455),Kt=a(462),$t=["Select your AOI","Choose variable","Select data range"],Qt=Object(ht.a)(function(e){return{root:{width:"100%","& .MuiDropzoneArea-root":{minHeight:"100px",maxHeight:"200px"}},fileDetails:{marginTop:e.spacing(1)},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0,fontWeight:"bold"},secondaryHeading:{fontSize:e.typography.pxToRem(15),color:e.palette.text.secondary},checkBoxContainer:{display:"flex",flexDirection:"row",justifyContent:"center",flexWrap:"wrap"},formControl:{margin:e.spacing(1),minWidth:120,width:"100%"},inputLabel:{marginBottom:e.spacing(1)},dateInput:{width:"100%",marginTop:e.spacing(2),marginBottom:e.spacing(2)},foormControl:{margin:e.spacing(3)},dropzone:{minHeight:"191px"},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},progressText:{marginLeft:e.spacing(2)}}});function Yt(e){e.onSubmit;var t=Qt(),a=Object(n.useState)([]),i=Object(Ae.a)(a,2),r=(i[0],i[1]),l=Object(n.useState)(0),s=Object(Ae.a)(l,2),c=s[0],d=s[1],u=Object(n.useState)([]),m=Object(Ae.a)(u,2),p=m[0],h=m[1],f=Object(n.useState)({startDate:"",endDate:"",equipmentType:"",dataType:""}),v=Object(Ae.a)(f,2),y=v[0],b=v[1],x=Object(n.useState)([]),C=Object(Ae.a)(x,2),E=(C[0],C[1],Object(n.useState)(!1)),w=Object(Ae.a)(E,2),k=w[0],S=w[1],I=Object(n.useState)(0),L=Object(Ae.a)(I,2),O=L[0],D=L[1],j=Object(n.useState)(!1),P=Object(Ae.a)(j,2),T=P[0],B=P[1],A=function(e,t){var a=e.file.type,n={className:t.image};if(a.startsWith("video/"))return o.a.createElement(ft.a,n);switch(a){case"application/msword":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return o.a.createElement(vt.a,n);case"application/pdf":return o.a.createElement(yt.a,n);default:return o.a.createElement(bt.a,n)}},R=function(e){b(Object(fe.a)({},y,Object(ge.a)({},e.target.name,e.target.value)))},M=function(e){console.log(e.sort(function(e,t){return e.Date-t.Date}));var t=e.sort(function(e,t){return e.Date-t.Date}),a={type:"scatter",mode:"lines",x:t.map(function(e){return new Date(e.Date)}),y:t.map(function(e){return e.Value}),name:y.dataType};h([a])},_={title:y.dataType+" Visualization",xaxis:{title:"Date",type:"date"},yaxis:{title:y.dataType+" Content"}},F=function(){var e=Object(z.a)(W.a.mark(function e(){var t,a,n;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,S(!0),D(0),(t=new FormData).append("aoiDataFiles",y.aoiDataFiles[0]),t.append("varType",y.dataType),e.next=8,fetch("http://localhost:5004/spatiotemporal_analysis",{method:"POST",body:t});case 8:return a=e.sent,B(!0),e.next=12,a.json();case 12:n=e.sent,console.log(n),n&&n.output&&(console.log(n.output[0]),console.log(t),M(n.output)),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Failed to fetch data: ",e.t0);case 20:return e.prev=20,S(!1),e.finish(20);case 23:case"end":return e.stop()}},e,null,[[0,17,20,23]])}));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(function(){var e;return k?e=setInterval(function(){D(function(e){return e+1})},1e3):clearInterval(e),function(){return clearInterval(e)}},[k]);return o.a.createElement(qt.a,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},!T&&o.a.createElement(Jt.a,{activeStep:c,sx:{width:"80%",marginBottom:2}},$t.map(function(e){return o.a.createElement(Zt.a,{key:e},o.a.createElement(Kt.a,null,e))})),o.a.createElement("div",null,c!==$t.length||k?o.a.createElement(o.a.Fragment,null,function(e){switch(e){case 0:return o.a.createElement(qt.a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"}},o.a.createElement(xt.a,{onChange:function(e){return function(e,t){if(t&&t.length>0){var a=new FileReader;a.onload=function(){var e=Object(z.a)(W.a.mark(function e(t){var a,n,o;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(It.a)(t.target.result);case 3:a=e.sent,n=a.features.length>0?Object.keys(a.features[0].properties):[],o=n.filter(function(e){return"number"===typeof a.features[0].properties[e]}),r(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error processing shapefile",e.t0);case 12:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t){return e.apply(this,arguments)}}(),a.readAsArrayBuffer(t[0])}b(function(a){return Object(fe.a)({},a,Object(ge.a)({},e,t))})}("aoiDataFiles",e)},acceptedFiles:[".zip"],dropzoneText:"Area of Interest (AOI)",maxFileSize:5e6,filesLimit:1,getPreviewIcon:A}));case 1:return o.a.createElement(qt.a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},o.a.createElement(be.a,{id:"data-type-label"},"Data Type"),o.a.createElement(xe.a,{labelId:"data-type-label",id:"data-type-select",value:y.dataType,onChange:R,name:"dataType",sx:{width:200,margin:1}},o.a.createElement(we.a,{value:"NDVI"},"NDVI"),o.a.createElement(we.a,{value:"EVI"},"EVI"),o.a.createElement(we.a,{value:"TSAVI"},"TSAVI"),o.a.createElement(we.a,{value:"MSI"},"MSI"),o.a.createElement(we.a,{value:"PRECIPT"},"PRECIPT"),o.a.createElement(we.a,{value:"TREE_COVER"},"TREE COVER %"),o.a.createElement(we.a,{value:"ABVGRND_CARBON"},"ABVGRND CARBON")));case 2:return o.a.createElement(qt.a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},o.a.createElement(be.a,{id:"data-type-label"},"Data Range"),o.a.createElement(K.a,{label:"Start Date",type:"date",name:"startDate",value:y.startDate,onChange:R,InputLabelProps:{shrink:!0},sx:{margin:1}}),o.a.createElement(K.a,{label:"End Date",type:"date",name:"endDate",value:y.endDate,onChange:R,InputLabelProps:{shrink:!0},sx:{margin:1}}))}}(c),o.a.createElement(qt.a,{sx:{display:"flex",flexDirection:"row",pt:2,alignItems:"center",justifyContent:"center"}},o.a.createElement(g.a,{disabled:0===c,onClick:function(){d(function(e){return e-1})}},"Back"),o.a.createElement(g.a,{onClick:function(){c===$t.length-1&&F(),d(function(e){return e+1})}},c===$t.length-1?"Finish":"Next")),k&&o.a.createElement(gt.a,{className:t.backdrop,open:k},o.a.createElement(q.a,{color:"inherit"}),o.a.createElement($.a,{variant:"h6",className:t.progressText},"Ejecutando la consulta... ",O,"s"))):o.a.createElement(o.a.Fragment,null,o.a.createElement(g.a,{onClick:function(){d(0),b({startDate:"",endDate:"",equipmentType:"",dataType:""}),h([]),B(!1)}},"Reset"),o.a.createElement(He.a,{data:p,layout:_}))))}var Xt=Object(O.b)({palette:{primary:{main:Y.a.A200}}}),ea={root:{position:"fixed",top:74,right:10,borderRadius:4,minWidth:350,margin:0,zIndex:900},rooot:{width:"100%"},heading:{fontSize:Xt.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0},secondaryHeading:{fontSize:Xt.typography.pxToRem(15),color:Xt.palette.text.secondary},header:{backgroundColor:"#f1f1f1"},closeBtn:{position:"absolute",top:6,right:8,fontSize:22},searchField:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"2px 4px"},searchBox:{marginLeft:8,flex:1,border:"none !important"},searchBoxBtn:{padding:8},searchOptionsContainer:{padding:"5px 2px"},searchOption:{color:"rgba(0, 0, 0, 0.6)",cursor:"pointer"},searchBoxProgress:{marginRight:8},searchBoxDivider:{width:1,height:28,margin:4},resultWrapperOpen:{maxWidth:800},resultWrapperClosed:{maxWidth:350},resultContainer:{paddingTop:0,paddingBottom:0},resultTable:{boxShadow:"none"},uploadBoxInput:{display:"none"},uploadBoxBtnEdit:{width:40,height:40,lineHeight:"40px",textAlign:"center",borderRadius:"50%",fontSize:22},wrapBtn:{position:"absolute",bottom:12,left:18,padding:10,fontSize:24},addPointWrapperOpen:{maxWidth:350},addPointWrapperClose:{width:0},uploadBoxBtnAdd:{width:90,height:90,lineHeight:"90px",textAlign:"center",borderRadius:"50%",fontSize:30,backgroundColor:"rgba(0, 0, 0, 0.08)"},previewImageContainer:{display:"flex",alignItems:"center"},nameTextField:{margin:"0 20px 0 13px"},pinyinTextField:{margin:"10px 20px 10px 13px"},introTextField:{width:"100%",marginTop:5},locationImageContainer:{display:"flex",flexDirection:"column",alignItems:"center"},locationImage:{display:"block",marginTop:5,width:225,height:140,borderRadius:3,cursor:"pointer"},locationLabel:{display:"block",marginTop:6},actions:{paddingTop:10},saveBtn:{display:"inline-block",position:"relative",marginRight:10},saveBtnProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}},ta=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={open:!1},a.handleCloseClick=function(){a.setState({open:!1})},a.handleDataSubmit=function(e){a.setState({url:e}),console.log("Datos recibidos en BandController:",e),f.emit("moveURL",a.state.url)},a.handleWrapClick=function(){f.emit("removeTempLayer"),a.resetPreviewImage(),document.getElementById("search-box").value="",a.setState({resultUnwrap:!1})},a.handleSearchOptionChange=function(e){var t=null,n=!1;if(a.state.searchOptions.map(function(a){return a.value===e.currentTarget.value&&(a.checked=e.currentTarget.checked,t=a),n=n||a.checked,!0}),!n)return f.emit("showSnackbar","error","Error: Please select at least one option."),void(t.checked=!0);a.setState({searchOptions:a.state.searchOptions})},a.handleSearchClick=function(){a.handleCancelClick();var e=document.getElementById("search-box").value;if(e){a.setState({searching:!0});var t={};a.state.searchOptions.map(function(e){return t[e.value]=e.checked,!0}),We({url:Ue.search.url,method:Ue.search.method,params:{keyword:e,options:JSON.stringify(t)},successCallback:function(e){a.setState({addPointWrapperClose:!1,resultUnwrap:!0,data:e.data},a.initMaterialbox)},finallyCallback:function(){a.setState({searching:!1})}})}},a.handlePreviewClick=function(e,t){f.emit("displayTempLayer",t)},a.handlePreviewMapClick=function(){f.emit("getPoint"),a.setState({addPointUnwrap:!1})},a.handleSelectChange=function(e){a.setState(Object(ge.a)({},e.target.name,Number(e.target.value)))},a.handleSubmitClick=function(){f.emit("removeTempPoint"),a.setState({submitting:!0});var e={name:document.getElementById("name").value,pinyin:document.getElementById("pinyin").value,introduction:document.getElementById("introduction").value,image:a.state.previewImage?a.state.previewImage:{},geometry:a.state.geometry};We({url:Ue.insert.url,method:Ue.insert.method,params:e,successCallback:function(e){f.emit("showSnackbar","success","Insert new object with Gid = '".concat(e.gid,"' successfully.")),a.handleCancelClick()},finallyCallback:function(){a.setState({searching:!1,submitting:!1})}})},a.handleCancelClick=function(){f.emit("removeTempPoint"),document.getElementById("name").value="",document.getElementById("pinyin").value="",document.getElementById("introduction").value="",a.resetPreviewImage(),a.resetNewPointData(),a.setState({addPointUnwrap:!1})},a.moveURL=function(){var e=a.state.url;a.setState({movedURL:e}),console.log(a.state.movedURL)},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("anchorEl"),a=new FileReader;a.onload=function(t){var a=new Image;a.src=t.target.result;var n={longitude:a.height>a.width,src:t.target.result};e.setState({previewImage:n})},this.setState({reader:a,anchorEl:t}),this.openSpatioTemporalAnalysisControllerListener=f.addListener("openSpatioTemporalAnalysisController",function(){e.setState({open:!0})}),this.closeAllControllerListener=f.addListener("closeAllController",function(){e.setState({open:!1})}),this.updatePointListener=f.addListener("setPoint",function(t,a,n){var o=Object(Ae.a)(t.geometry.coordinates,2),i=o[0],r=o[1],l="https://api.mapbox.com/styles/v1/".concat(a,"/static/pin-s+f00(").concat(i,",").concat(r,")/").concat(i,",").concat(r,",").concat(n,",0,1/250x155@2x?access_token=").concat(_e);e.setState({addPointUnwrap:!0,previewMapUrl:l,geometry:t,previewCoordinate:{lng:parseFloat(i).toFixed(3),lat:parseFloat(r).toFixed(3)}})}),this.moveURListener=f.addListener("moveURL",function(){e.moveURL()})}},{key:"componentWillUnmount",value:function(){f.removeListener(this.openSpatioTemporalAnalysisControllerListener),f.removeListener(this.closeAllControllerListener),f.removeListener(this.addPointListener),f.removeListener(this.updatePointListener),f.removeListener(this.moveURListener),document.querySelectorAll(".materialboxed").map(function(e){return e.destory()})}},{key:"render",value:function(){return o.a.createElement(D.a,{theme:Xt},o.a.createElement(Z.a,{direction:"left",in:this.state.open},o.a.createElement(ce.a,{style:ea.root},o.a.createElement(de.a,{style:ea.header},o.a.createElement($.a,{variant:"h5",className:ea.title},"Spatiotemporal Analysis"),"\xa0\xa0",o.a.createElement(Yt,null),o.a.createElement(I.a,{style:ea.closeBtn,"aria-label":"Close",onClick:this.handleCloseClick},o.a.createElement(L.a,{fontSize:"inherit"},"chevron_right"))))))}}]),t}(o.a.Component),aa=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return o.a.createElement(h.SnackbarProvider,{maxSnack:3},o.a.createElement(o.a.Fragment,null,o.a.createElement(y,null),o.a.createElement(E,null),o.a.createElement(A,null),o.a.createElement(U,null),o.a.createElement(le,null),o.a.createElement(se,null),o.a.createElement(he,null),o.a.createElement(Be,null),o.a.createElement(Nt,null),o.a.createElement(Pt,null),o.a.createElement(Gt,null),o.a.createElement(ta,null),o.a.createElement(pt,null),o.a.createElement(qe,null),o.a.createElement(dt,null),o.a.createElement(ct,null),o.a.createElement(rt,null)))}}]),t}(o.a.Component),na=function(){return o.a.createElement(l.a,null,o.a.createElement(s.c,null,o.a.createElement(s.a,{exact:!0,path:"/",component:aa})))},oa=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ia(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}r.a.render(o.a.createElement(function(){return o.a.createElement(na,null)},null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/geoviewer",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/geoviewer","/service-worker.js");oa?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ia(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):ia(t,e)})}}()},86:function(e,t,a){}},[[244,1,2]]]);
//# sourceMappingURL=main.ae9cee86.chunk.js.map